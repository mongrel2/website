<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>3 Managing</title> 
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- index=1,2,next,fn-in,html --> 
<meta name="src" content="book-final.tex"> 
<meta name="date" content="2015-12-31 01:17:00"> 
<link rel="stylesheet" type="text/css" href="book-final.css"> 
</head><body 
>
<!--l. 1--><div class="crosslinks"><p class="noindent">[<a 
href="book-finalch5.html" >next</a>] [<a 
href="book-finalch3.html" >prev</a>] [<a 
href="book-finalch3.html#tailbook-finalch3.html" >prev-tail</a>] [<a 
href="#tailbook-finalch4.html">tail</a>] [<a 
href="book-final.html#book-finalch4.html" >up</a>] </p></div>
<h2 class="chapterHead"><span class="titlemark">Chapter&#x00A0;3</span><br /><a 
 id="x6-200003"></a>Managing</h2>
<!--l. 3--><p class="noindent" >Mongrel2 is designed to be easy to deploy and <span 
class="pplri7t-">automate </span>the deployment. This is why
it uses <a 
href="http://www.sqlite.org/" >SQLite</a> to store the configuration, but m2sh as an interface to creating
the configuration. Doing this lets you access the configuration using any
language that works for you, augment it, alter it, migrate it, and automate
it.
<!--l. 9--><p class="noindent" >In this chapter, I&#8217;m going to show you how to make a basic configuration using m2sh
and all the commands that are available. You&#8217;ll learn how the configuration system is
structured so that you know what goes where, but in the end it&#8217;s just a simple
storage mechanism.
                                                                  

                                                                  
<!--l. 14--><p class="noindent" ><a 
 id="x6-20001r2"></a><hr class="float"><div class="float" 
>
                                                                  

                                                                  
 <div class="caption" 
><span class="id">Note 2: </span><span  
class="content">                                                                                   <span 
class="pplri7t-">Apparently SQL Inspires</span>
<span 
class="pplri7t-">FUD</span></span></div><!--tex4ht:label?: x6-20001r2 -->
     <div class="quote">
     <!--l. 15--><p class="indent" >   When  I  first  started  talking  about  Mongrel2,  I  said  I&#8217;d  store
     the configuration in SQLite and do a Model-View-Controller kind
     of  design.  Immediately,  people  who  can&#8217;t  read  flipped  out  and
     thought this meant they&#8217;d be back in &#8220;Windows registry hell&#8221;, but
     with SQL as their only way to access it. They thought that they&#8217;d be
     stuck writing configurations with SQL; that SQL couldn&#8217;t possibly
     configure a web server.
     <!--l. 21--><p class="indent" >   They were wrong on many levels. Nobody was <span 
class="pplri7t-">ever </span>going to make
     <span 
class="pplri7t-">anyone </span>use SQL. That was repeated over and over but, again, people
     don&#8217;t read and love spreading FUD. The SQLite config database is
     nothing like the Windows Registry. No other web server really uses
     a true hierarchy; they just cram a relational model into a weirdo
     configuration format. The real goal was to make a web server that
     was easy to manage from <span 
class="pplri7t-">any </span>language, and then give people a nice
     tool to get their job done without having to ever touch SQL. <span 
class="pplri7t-">EVER!</span>
     <!--l. 29--><p class="indent" >   In the end, what we got despite all this fear mongering is a bad ass
     configuration tool and a design that is simple, elegant, and works
     fantastically.  If  you  read  that  Mongrel2  uses  SQLite  and  thought
     this was weird, well, welcome to the future. Sometimes it&#8217;s weird
     out here (even though Postfix has been doing this for a decade or
     more). </div>
                                                                  

                                                                  
</div><hr class="endfloat" />
<h3 class="sectionHead"><span class="titlemark">3.1    </span> <a 
 id="x6-210003.1"></a>Model-View-Controller</h3>
<!--l. 38--><p class="noindent" >When you hear Model-View-Controller, you think about web applications.
This is a design pattern where you place different concerns into different
parts of your system and try not to mix them too much. For an interactive
application, if you keep the part that stores data (Model) separated from the logic
(Controller) and use another piece to display and interact with the user
(View), then it&#8217;s easier to change the system and adapt it over time to new
features.
<!--l. 44--><p class="noindent" >The power of MVC is simply that these things really are separate orthogonal pieces
that get ugly if they&#8217;re mixed together. There&#8217;s no math or theory that says why; just
lots of experience has told us it&#8217;s usually a bad idea. When you start mixing them,
you find out that it&#8217;s hard to change for new requirements later, because you&#8217;ve
sprinkled logic all over your web pages. Or you can&#8217;t update your database
because there&#8217;s all these stored procedures that assume the tables are a certain
way.
<!--l. 51--><p class="noindent" >Mongrel2 needed a way to allow you to use various languages and tools to automate
its configuration. Letting you automate your deployments is the entire point of the
server. The idea was that if we gave you the Controller and the Model, then you
can craft any <span 
class="pplri7t-">View </span>you wanted, and there&#8217;s no better Model than a SQL
database like SQLite: it&#8217;s embeddable, easily accessed from C or any language,
portable, small, fast enough and full of all the features you need and then
some.
<!--l. 57--><p class="noindent" >What you are doing when you use m2sh (from <span 
class="pcrb7t-">tools/m2sh</span>) to configure a
configuration for Mongrel2, is working with a View we&#8217;ve given you to create a
Model for the Mongrel2 server to work with. That&#8217;s it, and you can create your own
View if you want. It could be automated deployment scripts, a web interface,
monitoring scripts, anything you need.
<!--l. 63--><p class="noindent" >The point is, if you just want to get Mongrel2 up and running, then use m2sh. If you
want to do more advanced stuff, then get into the configuration database schema
and see what you can do. The structure of the database very closely matches
Mongrel2&#8217;s internal structure, so understanding that means you understand how
Mongrel2 works. This is a vast improvement over other web servers like Apache
where you&#8217;ve got no idea why one stanza has to go in a particular place, or why
information has to be duplicated.
<!--l. 70--><p class="noindent" >With Mongrel2, it&#8217;s all right there.
                                                                  

                                                                  
<!--l. 73--><p class="noindent" >
<h3 class="sectionHead"><span class="titlemark">3.2    </span> <a 
 id="x6-220003.2"></a>Trying m2sh</h3>
<!--l. 75--><p class="noindent" >To give this configuration system a try, you just need to run the test configuration
used in the unit tests. Let&#8217;s try doing a few of the most basic commands with this
configuration.
<!--l. 78--><p class="noindent" >First, make sure you are in the mongrel2 source and you&#8217;ve ran the build so that you
get the <span 
class="pcrb7t-">tests/config.sqlite </span>file primed. This is our base test case that we use in
unit testing. After you have that, do this:
                                                                  

                                                                  
<!--l. 82--><p class="noindent" ><a 
 id="x6-22001r5"></a><hr class="float"><div class="float" 
>
                                                                  

                                                                  
 <div class="caption" 
><span class="id">Source 5: </span><span  
class="content">                                                                                                   <span 
class="pplri7t-">Sample m2sh</span>
<span 
class="pplri7t-">Commands</span></span></div><!--tex4ht:label?: x6-22001r5 -->
<div class="fancyvrb" id="fancyvrb5"><a 
 id="x6-22003r1"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span id="textcolor11"><span 
class="pcrr7t-x-x-90">#</span><span 
class="pcrr7t-x-x-90">&#x00A0;get</span><span 
class="pcrr7t-x-x-90">&#x00A0;list</span><span 
class="pcrr7t-x-x-90">&#x00A0;of</span><span 
class="pcrr7t-x-x-90">&#x00A0;the</span><span 
class="pcrr7t-x-x-90">&#x00A0;available</span><span 
class="pcrr7t-x-x-90">&#x00A0;servers</span><span 
class="pcrr7t-x-x-90">&#x00A0;to</span><span 
class="pcrr7t-x-x-90">&#x00A0;run</span></span><br class="fancyvrb" /><a 
 id="x6-22005r2"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;m2sh</span><span 
class="pcrr7t-x-x-90">&#x00A0;servers</span><span 
class="pcrr7t-x-x-90">&#x00A0;-db</span><span 
class="pcrr7t-x-x-90">&#x00A0;tests/config.sqlite</span>
<br class="fancyvrb" /><a 
 id="x6-22007r3"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br class="fancyvrb" /><a 
 id="x6-22009r4"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span id="textcolor12"><span 
class="pcrr7t-x-x-90">#</span><span 
class="pcrr7t-x-x-90">&#x00A0;see</span><span 
class="pcrr7t-x-x-90">&#x00A0;what</span><span 
class="pcrr7t-x-x-90">&#x00A0;hosts</span><span 
class="pcrr7t-x-x-90">&#x00A0;a</span><span 
class="pcrr7t-x-x-90">&#x00A0;server</span><span 
class="pcrr7t-x-x-90">&#x00A0;has</span></span><br class="fancyvrb" /><a 
 id="x6-22011r5"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;m2sh</span><span 
class="pcrr7t-x-x-90">&#x00A0;hosts</span><span 
class="pcrr7t-x-x-90">&#x00A0;-db</span><span 
class="pcrr7t-x-x-90">&#x00A0;tests/config.sqlite</span><span 
class="pcrr7t-x-x-90">&#x00A0;-server</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span id="textcolor13"><span 
class="pcrr7t-x-x-90">test</span></span>
<br class="fancyvrb" /><a 
 id="x6-22013r6"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br class="fancyvrb" /><a 
 id="x6-22015r7"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span id="textcolor14"><span 
class="pcrr7t-x-x-90">#</span><span 
class="pcrr7t-x-x-90">&#x00A0;find</span><span 
class="pcrr7t-x-x-90">&#x00A0;out</span><span 
class="pcrr7t-x-x-90">&#x00A0;if</span><span 
class="pcrr7t-x-x-90">&#x00A0;a</span><span 
class="pcrr7t-x-x-90">&#x00A0;server</span><span 
class="pcrr7t-x-x-90">&#x00A0;named</span><span 
class="pcrr7t-x-x-90">&#x00A0;'test'</span><span 
class="pcrr7t-x-x-90">&#x00A0;is</span><span 
class="pcrr7t-x-x-90">&#x00A0;running</span></span>
<br class="fancyvrb" /><a 
 id="x6-22017r8"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;m2sh</span><span 
class="pcrr7t-x-x-90">&#x00A0;running</span><span 
class="pcrr7t-x-x-90">&#x00A0;-db</span><span 
class="pcrr7t-x-x-90">&#x00A0;tests/config.sqlite</span><span 
class="pcrr7t-x-x-90">&#x00A0;-name</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span id="textcolor15"><span 
class="pcrr7t-x-x-90">test</span></span><br class="fancyvrb" /><a 
 id="x6-22019r9"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span>
<br class="fancyvrb" /><a 
 id="x6-22021r10"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span id="textcolor16"><span 
class="pcrr7t-x-x-90">#</span><span 
class="pcrr7t-x-x-90">&#x00A0;start</span><span 
class="pcrr7t-x-x-90">&#x00A0;a</span><span 
class="pcrr7t-x-x-90">&#x00A0;server</span><span 
class="pcrr7t-x-x-90">&#x00A0;whose</span><span 
class="pcrr7t-x-x-90">&#x00A0;default</span><span 
class="pcrr7t-x-x-90">&#x00A0;host</span><span 
class="pcrr7t-x-x-90">&#x00A0;is</span><span 
class="pcrr7t-x-x-90">&#x00A0;'localhost'</span></span>
<br class="fancyvrb" /><a 
 id="x6-22023r11"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;m2sh</span><span 
class="pcrr7t-x-x-90">&#x00A0;start</span><span 
class="pcrr7t-x-x-90">&#x00A0;-db</span><span 
class="pcrr7t-x-x-90">&#x00A0;tests/config.sqlite</span><span 
class="pcrr7t-x-x-90">&#x00A0;-host</span><span 
class="pcrr7t-x-x-90">&#x00A0;localhost</span></div>
                                                                  

                                                                  
</div><hr class="endfloat" />
<!--l. 99--><p class="noindent" >At this point, you should have seen lists of servers and hosts, seen that mongrel2 is
not running, and then started it. You can find out about all the commands and get
help for them with <span 
class="pcrro7t-">m2sh help </span>or <span 
class="pcrro7t-">ms2h help --on command</span>.
<!--l. 103--><p class="noindent" >You can now try doing some simple starting, stopping and reloading using sudo
(make sure you CTRL-c to exit from the previous <span 
class="pcrro7t-">start </span>command):
                                                                  

                                                                  
<!--l. 106--><p class="noindent" ><a 
 id="x6-22024r6"></a><hr class="float"><div class="float" 
>
                                                                  

                                                                  
 <div class="caption" 
><span class="id">Source 6: </span><span  
class="content">                                                                                         <span 
class="pplri7t-">Starting, Stopping,</span>
<span 
class="pplri7t-">Reloading</span></span></div><!--tex4ht:label?: x6-22024r6 -->
<div class="fancyvrb" id="fancyvrb6"><a 
 id="x6-22026r1"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span id="textcolor17"><span 
class="pcrr7t-x-x-90">#</span><span 
class="pcrr7t-x-x-90">&#x00A0;start</span><span 
class="pcrr7t-x-x-90">&#x00A0;it</span><span 
class="pcrr7t-x-x-90">&#x00A0;so</span><span 
class="pcrr7t-x-x-90">&#x00A0;it</span><span 
class="pcrr7t-x-x-90">&#x00A0;runs</span><span 
class="pcrr7t-x-x-90">&#x00A0;in</span><span 
class="pcrr7t-x-x-90">&#x00A0;the</span><span 
class="pcrr7t-x-x-90">&#x00A0;background</span><span 
class="pcrr7t-x-x-90">&#x00A0;via</span><span 
class="pcrr7t-x-x-90">&#x00A0;sudo</span></span>
<br class="fancyvrb" /><a 
 id="x6-22028r2"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;m2sh</span><span 
class="pcrr7t-x-x-90">&#x00A0;start</span><span 
class="pcrr7t-x-x-90">&#x00A0;-db</span><span 
class="pcrr7t-x-x-90">&#x00A0;tests/config.sqlite</span><span 
class="pcrr7t-x-x-90">&#x00A0;-host</span><span 
class="pcrr7t-x-x-90">&#x00A0;localhost</span><span 
class="pcrr7t-x-x-90">&#x00A0;-sudo</span><br class="fancyvrb" /><a 
 id="x6-22030r3"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;tail</span><span 
class="pcrr7t-x-x-90">&#x00A0;logs/error.log</span><br class="fancyvrb" /><a 
 id="x6-22032r4"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span>
<br class="fancyvrb" /><a 
 id="x6-22034r5"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span id="textcolor18"><span 
class="pcrr7t-x-x-90">#</span><span 
class="pcrr7t-x-x-90">&#x00A0;reload</span><span 
class="pcrr7t-x-x-90">&#x00A0;it</span></span><br class="fancyvrb" /><a 
 id="x6-22036r6"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;m2sh</span><span 
class="pcrr7t-x-x-90">&#x00A0;reload</span><span 
class="pcrr7t-x-x-90">&#x00A0;-db</span><span 
class="pcrr7t-x-x-90">&#x00A0;tests/config.sqlite</span><span 
class="pcrr7t-x-x-90">&#x00A0;-host</span><span 
class="pcrr7t-x-x-90">&#x00A0;localhost</span><br class="fancyvrb" /><a 
 id="x6-22038r7"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;tail</span><span 
class="pcrr7t-x-x-90">&#x00A0;logs/error.log</span>
<br class="fancyvrb" /><a 
 id="x6-22040r8"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br class="fancyvrb" /><a 
 id="x6-22042r9"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span id="textcolor19"><span 
class="pcrr7t-x-x-90">#</span><span 
class="pcrr7t-x-x-90">&#x00A0;hit</span><span 
class="pcrr7t-x-x-90">&#x00A0;is</span><span 
class="pcrr7t-x-x-90">&#x00A0;with</span><span 
class="pcrr7t-x-x-90">&#x00A0;curl</span><span 
class="pcrr7t-x-x-90">&#x00A0;to</span><span 
class="pcrr7t-x-x-90">&#x00A0;see</span><span 
class="pcrr7t-x-x-90">&#x00A0;it</span><span 
class="pcrr7t-x-x-90">&#x00A0;do</span><span 
class="pcrr7t-x-x-90">&#x00A0;the</span><span 
class="pcrr7t-x-x-90">&#x00A0;reload</span></span><br class="fancyvrb" /><a 
 id="x6-22044r10"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;curl</span><span 
class="pcrr7t-x-x-90">&#x00A0;http://localhost:6767/</span>
<br class="fancyvrb" /><a 
 id="x6-22046r11"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;tail</span><span 
class="pcrr7t-x-x-90">&#x00A0;logs/error.log</span><br class="fancyvrb" /><a 
 id="x6-22048r12"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br class="fancyvrb" /><a 
 id="x6-22050r13"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span id="textcolor20"><span 
class="pcrr7t-x-x-90">#</span><span 
class="pcrr7t-x-x-90">&#x00A0;see</span><span 
class="pcrr7t-x-x-90">&#x00A0;if</span><span 
class="pcrr7t-x-x-90">&#x00A0;it's</span><span 
class="pcrr7t-x-x-90">&#x00A0;running</span><span 
class="pcrr7t-x-x-90">&#x00A0;then</span><span 
class="pcrr7t-x-x-90">&#x00A0;stop</span><span 
class="pcrr7t-x-x-90">&#x00A0;it</span></span>
<br class="fancyvrb" /><a 
 id="x6-22052r14"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;m2sh</span><span 
class="pcrr7t-x-x-90">&#x00A0;running</span><span 
class="pcrr7t-x-x-90">&#x00A0;-db</span><span 
class="pcrr7t-x-x-90">&#x00A0;tests/config.sqlite</span><span 
class="pcrr7t-x-x-90">&#x00A0;-host</span><span 
class="pcrr7t-x-x-90">&#x00A0;localhost</span>
<br class="fancyvrb" /><a 
 id="x6-22054r15"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;m2sh</span><span 
class="pcrr7t-x-x-90">&#x00A0;stop</span><span 
class="pcrr7t-x-x-90">&#x00A0;-db</span><span 
class="pcrr7t-x-x-90">&#x00A0;tests/config.sqlite</span><span 
class="pcrr7t-x-x-90">&#x00A0;-host</span><span 
class="pcrr7t-x-x-90">&#x00A0;localhost</span></div>
                                                                  

                                                                  
</div><hr class="endfloat" />
                                                                  

                                                                  
<!--l. 127--><p class="noindent" ><a 
 id="x6-22055r3"></a><hr class="float"><div class="float" 
>
                                                                  

                                                                  
<div class="caption" 
><span class="id">Note 3: </span><span  
class="content">                                                                                 <span 
class="pplri7t-">Warning: contents may be</span>
<span 
class="pplri7t-">broken</span></span></div><!--tex4ht:label?: x6-22055r3 -->
     <div class="quote">
     <!--l. 128--><p class="indent" >   If  <span 
class="pcrro7t-">m2sh start </span>runs  fine,  but  <span 
class="pcrro7t-">m2sh start -sudo </span>fails,  you
     may need to link <span 
class="pcrb7t-">/proc </span>in your chroot, using <span 
class="pcrro7t-">mkdir -p proc &amp;&amp;</span>
     <span 
class="pcrro7t-">sudo mount --bind /proc proc</span>.  You  can  also  try  installing
     ZeroMQ  from  source,  if  you&#8217;d  rather  avoid  putting  your  <span 
class="pcrb7t-">/proc</span>
     where it might get seen. </div>
                                                                  

                                                                  
</div><hr class="endfloat" />
<!--l. 135--><p class="noindent" >Awesome, right? Using just this one little management tool you are able
to completely manage a Mongrel2 instance without having to hack on a
config file at all. But you probably need to know how this is all working
anyway.
<h4 class="subsectionHead"><span class="titlemark">3.2.1    </span> <a 
 id="x6-230003.2.1"></a>What The Hell Just Happened?</h4>
<!--l. 143--><p class="noindent" >You now have done nearly everything you can to a configuration, but you might not
know exactly what&#8217;s going on. Here&#8217;s an explanation of what&#8217;s going on behind the
scenes:
<!--l. 146--><p class="noindent" >
     <ol  class="enumerate1" >
     <li 
  class="enumerate" id="x6-23002x1">When  you  did  <span 
class="pcrro7t-">m2sh start </span>with  the  <span 
class="pcrro7t-">-sudo </span>option,  it  actually  runs
     <span 
class="pcrro7t-">sudo mongrel2 tests/config.sqlite localhost </span>to   start   the
     server.
     </li>
     <li 
  class="enumerate" id="x6-23004x2">Mongrel2 is now running in the background as a daemon process, just
     like a regular server. However, what it did was <span 
class="pcrro7t-">chroot </span>to the current
     directory and then drop privileges so that they match the owner of that
     directory (you). Use <span 
class="pcrro7t-">ps aux </span>to take a look.
     </li>
     <li 
  class="enumerate" id="x6-23006x3">With Mongrel2 running, you can look in the <span 
class="pcrb7t-">logs/error.log </span>file to see
     what it said. It should be a bunch of debug logging, but check out the
     messages: nice and detailed.
     </li>
     <li 
  class="enumerate" id="x6-23008x4">Next you did a soft reload with <span 
class="pcrro7t-">m2sh reload </span>and you should notice
     that  your  mongrel2  process  was  able  to  load  the  new  config  <span 
class="pplri7t-">without</span>
     <span 
class="pplri7t-">restarting</span>.
     </li>
     <li 
  class="enumerate" id="x6-23010x5">However, there&#8217;s a slight bug that doesn&#8217;t do the reload until the next
     request  is  served.  That&#8217;s  what  the  <span 
class="pcrro7t-">curl http://localhost:6767/</span>
     was for.
     </li>
     <li 
  class="enumerate" id="x6-23012x6">Now that you can see this reload work in <span 
class="pcrb7t-">logs/error.log</span>, you used
     <span 
class="pcrro7t-">m2sh running </span>to see if it&#8217;s running. This command is just reading the
     config database to find out where the PID file is (<span 
class="pcrb7t-">run/mongrel2.pid</span>)
     and then checking if that process is running.
                                                                  

                                                                  
     </li>
     <li 
  class="enumerate" id="x6-23014x7">Finally, you tell mongrel2 to stop, and since it dropped privileges to be
     owned by you, you can do that without having to use sudo.</li></ol>
<!--l. 165--><p class="noindent" >All of this is happening by reading the <span 
class="pcrb7t-">tests/config.sqlite </span>file and not reading
any configuration files. You can now try building your own configuration that
matches this one or some others.
<!--l. 169--><p class="noindent" >
<h3 class="sectionHead"><span class="titlemark">3.3    </span> <a 
 id="x6-240003.3"></a>A Simple Configuration File</h3>
<!--l. 171--><p class="noindent" >To configure a new config database you&#8217;ll write a file that looks a lot like
a configuration file. It looks like a Python file, because it comes from the
first m2sh we wrote in Python (living in <span 
class="pcrb7t-">examples/python</span>), but now it&#8217;s
written in C. Even though it was rewritten, we managed to keep the same
format &#8212;and even make it a little easier by making commas optional in most
places.
<!--l. 177--><p class="noindent" >First you load your configuration into a fresh database using <span 
class="pcrro7t-">m2sh load</span>. For our
example, we&#8217;ll use the example configuration from <span 
class="pcrb7t-">examples/configs/sample.conf</span>
to make a simple one:
                                                                  

                                                                  
<!--l. 181--><p class="noindent" ><a 
 id="x6-24001r7"></a><hr class="float"><div class="float" 
>
                                                                  

                                                                  
 <div class="caption" 
><span class="id">Source 7: </span><span  
class="content">                                                                                        <span 
class="pplri7t-">Simple Little Config</span>
<span 
class="pplri7t-">Example</span></span></div><!--tex4ht:label?: x6-24001r7 -->
<!--l. 182-->
<div class="lstlisting" id="listing-1"><span class="label"><a 
 id="x6-24002r1"></a></span><span 
class="pcrr7t-x-x-90">main</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">=</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">Server</span><span 
class="pcrr7t-x-x-90">(</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-24003r2"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">uuid</span><span 
class="pcrr7t-x-x-90">="</span><span 
class="pcrr7t-x-x-90">f400bf85</span><span 
class="pcrr7t-x-x-90">-4538-4</span><span 
class="pcrr7t-x-x-90">f7a</span><span 
class="pcrr7t-x-x-90">-8908-67</span><span 
class="pcrr7t-x-x-90">e313d515c2</span><span 
class="pcrr7t-x-x-90">",</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-24004r3"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">access_log</span><span 
class="pcrr7t-x-x-90">="/</span><span 
class="pcrr7t-x-x-90">logs</span><span 
class="pcrr7t-x-x-90">/</span><span 
class="pcrr7t-x-x-90">access</span><span 
class="pcrr7t-x-x-90">.</span><span 
class="pcrr7t-x-x-90">log</span><span 
class="pcrr7t-x-x-90">",</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-24005r4"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">error_log</span><span 
class="pcrr7t-x-x-90">="/</span><span 
class="pcrr7t-x-x-90">logs</span><span 
class="pcrr7t-x-x-90">/</span><span 
class="pcrr7t-x-x-90">error</span><span 
class="pcrr7t-x-x-90">.</span><span 
class="pcrr7t-x-x-90">log</span><span 
class="pcrr7t-x-x-90">",</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-24006r5"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">chroot</span><span 
class="pcrr7t-x-x-90">="./",</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-24007r6"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">default_host</span><span 
class="pcrr7t-x-x-90">="</span><span 
class="pcrr7t-x-x-90">localhost</span><span 
class="pcrr7t-x-x-90">",</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-24008r7"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">name</span><span 
class="pcrr7t-x-x-90">="</span><span 
class="pcrr7t-x-x-90">test</span><span 
class="pcrr7t-x-x-90">",</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-24009r8"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">pid_file</span><span 
class="pcrr7t-x-x-90">="/</span><span 
class="pcrr7t-x-x-90">run</span><span 
class="pcrr7t-x-x-90">/</span><span 
class="pcrr7t-x-x-90">mongrel2</span><span 
class="pcrr7t-x-x-90">.</span><span 
class="pcrr7t-x-x-90">pid</span><span 
class="pcrr7t-x-x-90">",</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-24010r9"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">port</span><span 
class="pcrr7t-x-x-90">=6767,</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-24011r10"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">hosts</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">=</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">[</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-24012r11"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">Host</span><span 
class="pcrr7t-x-x-90">(</span><span 
class="pcrr7t-x-x-90">name</span><span 
class="pcrr7t-x-x-90">="</span><span 
class="pcrr7t-x-x-90">localhost</span><span 
class="pcrr7t-x-x-90">",</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">routes</span><span 
class="pcrr7t-x-x-90">={</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-24013r12"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr8c-x-x-90">&#8217;</span><span 
class="pcrr7t-x-x-90">/</span><span 
class="pcrr7t-x-x-90">tests</span><span 
class="pcrr7t-x-x-90">/</span><span 
class="pcrr8c-x-x-90">&#8217;</span><span 
class="pcrr7t-x-x-90">:</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">Dir</span><span 
class="pcrr7t-x-x-90">(</span><span 
class="pcrr7t-x-x-90">base</span><span 
class="pcrr7t-x-x-90">=</span><span 
class="pcrr8c-x-x-90">&#8217;</span><span 
class="pcrr7t-x-x-90">tests</span><span 
class="pcrr7t-x-x-90">/</span><span 
class="pcrr8c-x-x-90">&#8217;</span><span 
class="pcrr7t-x-x-90">,</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">index_file</span><span 
class="pcrr7t-x-x-90">=</span><span 
class="pcrr8c-x-x-90">&#8217;</span><span 
class="pcrr7t-x-x-90">index</span><span 
class="pcrr7t-x-x-90">.</span><span 
class="pcrr7t-x-x-90">html</span><span 
class="pcrr8c-x-x-90">&#8217;</span><span 
class="pcrr7t-x-x-90">,</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-24014r13"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">default_ctype</span><span 
class="pcrr7t-x-x-90">=</span><span 
class="pcrr8c-x-x-90">&#8217;</span><span 
class="pcrr7t-x-x-90">text</span><span 
class="pcrr7t-x-x-90">/</span><span 
class="pcrr7t-x-x-90">plain</span><span 
class="pcrr8c-x-x-90">&#8217;</span><span 
class="pcrr7t-x-x-90">)</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-24015r14"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">})</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-24016r15"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">]</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-24017r16"></a></span><span 
class="pcrr7t-x-x-90">)</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-24018r17"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-24019r18"></a></span><span 
class="pcrr7t-x-x-90">servers</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">=</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">[</span><span 
class="pcrr7t-x-x-90">main</span><span 
class="pcrr7t-x-x-90">]</span>
</div>
                                                                  

                                                                  
</div><hr class="endfloat" />
<!--l. 205--><p class="noindent" >If you aren&#8217;t familiar with Python, then this code might look freaky, but it&#8217;s really
simple. We&#8217;ll get into how it&#8217;s structured in a second, but to load this file we would
just do this:
                                                                  

                                                                  
<!--l. 209--><p class="noindent" ><a 
 id="x6-24022r8"></a><hr class="float"><div class="float" 
>
                                                                  

                                                                  
 <div class="caption" 
><span class="id">Source 8: </span><span  
class="content">                                                                                        <span 
class="pplri7t-">Loading The Simple</span>
<span 
class="pplri7t-">Config</span></span></div><!--tex4ht:label?: x6-24022r8 -->
<div class="fancyvrb" id="fancyvrb7"><a 
 id="x6-24024r1"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;m2sh</span><span 
class="pcrr7t-x-x-90">&#x00A0;load</span><span 
class="pcrr7t-x-x-90">&#x00A0;-config</span><span 
class="pcrr7t-x-x-90">&#x00A0;examples/configs/sample.conf</span><br class="fancyvrb" /><a 
 id="x6-24026r2"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;ls</span><span 
class="pcrr7t-x-x-90">&#x00A0;-l</span><span 
class="pcrr7t-x-x-90">&#x00A0;config.sqlite</span>
<br class="fancyvrb" /><a 
 id="x6-24028r3"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;m2sh</span><span 
class="pcrr7t-x-x-90">&#x00A0;servers</span><br class="fancyvrb" /><a 
 id="x6-24030r4"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;m2sh</span><span 
class="pcrr7t-x-x-90">&#x00A0;hosts</span><span 
class="pcrr7t-x-x-90">&#x00A0;-server</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span id="textcolor21"><span 
class="pcrr7t-x-x-90">test</span></span><br class="fancyvrb" /><a 
 id="x6-24032r5"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;m2sh</span><span 
class="pcrr7t-x-x-90">&#x00A0;start</span><span 
class="pcrr7t-x-x-90">&#x00A0;-name</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span id="textcolor22"><span 
class="pcrr7t-x-x-90">test</span></span></div>
                                                                  

                                                                  
</div><hr class="endfloat" />
<!--l. 220--><p class="noindent" >Notice that we didn&#8217;t have to tell m2sh that the database was <span 
class="pcrb7t-">config.sqlite</span>. It
assumes that is the default, as well as that <span 
class="pcrb7t-">mongrel2.conf </span>is the config file you
want. If you use those two files, then you never have to type those parameters
again.
<!--l. 225--><p class="noindent" >With this sequence of commands you:
     <ol  class="enumerate1" >
     <li 
  class="enumerate" id="x6-24034x1">Create a raw fresh config database name <span 
class="pcrb7t-">config.sqlite </span>and load the
     <span 
class="pcrb7t-">sample.conf </span>into it.
     </li>
     <li 
  class="enumerate" id="x6-24036x2">List the servers it has configured.
     </li>
     <li 
  class="enumerate" id="x6-24038x3">List the hosts that server has, with what routes it has.
     </li>
     <li 
  class="enumerate" id="x6-24040x4">Start this server to try it out.</li></ol>
<!--l. 234--><p class="noindent" >By now you should be getting the hang of the pattern here, which is to use
m2sh and a configuration &#8220;script&#8221; to generate .sqlite files that Mongrel2
understands.
<h3 class="sectionHead"><span class="titlemark">3.4    </span> <a 
 id="x6-250003.4"></a>How A Config Is Structured</h3>
<!--l. 240--><p class="noindent" >The base structure of a Mongrel2 configuration is:
     <dl class="description"><dt class="description">
<span 
class="pplb7t-">Server</span> </dt><dd 
class="description">This is the root of a config, and you can have multiples of these in
     one database, even though each start command only runs one at a
     time.
         <dl class="description"><dt class="description">
     <span 
class="pplb7t-">Host</span> </dt><dd 
class="description">Servers have Hosts inside them, which say what DNS hostname
         Mongrel2 should answer for. You can have multiples of these in each
         Server.
             <dl class="description"><dt class="description">
         <span 
class="pplb7t-">Route</span> </dt><dd 
class="description">Hosts have Routes in them, which tells Mongrel2 what to do with
             URL paths and patterns that match them. Routes then have <span 
class="pcrro7t-">Dir</span>,
             <span 
class="pcrro7t-">Handler </span>or <span 
class="pcrro7t-">Proxy </span>items in them.
                <dl class="description"><dt class="description">
                                                                  

                                                                  
             <span 
class="pplb7t-">Dir</span> </dt><dd 
class="description">A Dir serves files out of a directory, complete with 304 and
                ETag support, default content types, and most of the things
                you need to serve them.
                </dd><dt class="description">
             <span 
class="pplb7t-">Proxy</span> </dt><dd 
class="description">A  Proxy  takes  requests  matching  the  Route  they&#8217;re
                attached   to   and   sends   them   to   another   HTTP   server
                somewhere else. Mongrel2 will then act as a full proxy and
                also try to keep connections open in keep-alive mode if the
                browser supports it.
                </dd><dt class="description">
             <span 
class="pplb7t-">Handler</span> </dt><dd 
class="description">A Handler is the best part of Mongrel2. It takes HTTP
                requests, and turns them into nicely packed and processed
                ZeroMQ messages for your asynchronous handlers.</dd></dl>
             </dd></dl>
         </dd></dl>
     </dd></dl>
<!--l. 264--><p class="noindent" >Each of these nested &#8220;objects&#8221; then has a set of attributes you can use to configure
them, and most of them have reasonable defaults.
<!--l. 268--><p class="noindent" >
<h4 class="subsectionHead"><span class="titlemark">3.4.1    </span> <a 
 id="x6-260003.4.1"></a>Server</h4>
<!--l. 270--><p class="noindent" >The server is all about telling Mongrel2 where to listen on its port, where to chroot,
and general server specific deployment gear.
     <dl class="description"><dt class="description">
<span 
class="pplb7t-">uuid</span> </dt><dd 
class="description">A UUID is used to make sure that each deployed server is unique in your
     infrastructure. You could easily use any string that&#8217;s letters, numbers, or
     <span class="obeylines-h"><span class="verb"><span 
class="pcrr7t-">-</span></span></span> characters.
     </dd><dt class="description">
<span 
class="pplb7t-">chroot</span> </dt><dd 
class="description">This   is   the   directory   that   Mongrel2   should   chroot   to   and   drop
     privileges.
     </dd><dt class="description">
<span 
class="pplb7t-">access</span><span 
class="pplb7t-">_log</span> </dt><dd 
class="description">The  access  log  file  <span 
class="pplri7t-">relative  to  the  chroot</span>.  Usually  starts  with  a  &#8216;/&#8217;.
     Make sure you configure your server so that this and other files aren&#8217;t
     accessible, or make this owned by root.
                                                                  

                                                                  
     </dd><dt class="description">
<span 
class="pplb7t-">error</span><span 
class="pplb7t-">_log</span> </dt><dd 
class="description">The error log file, just like <span 
class="pcrro7t-">access</span><span 
class="pcrro7t-">_log</span>.
     </dd><dt class="description">
<span 
class="pplb7t-">pid</span><span 
class="pplb7t-">_file</span> </dt><dd 
class="description">Like the access log, where within the chroot directory is the pid file
     stored.
     </dd><dt class="description">
<span 
class="pplb7t-">default</span><span 
class="pplb7t-">_host</span> </dt><dd 
class="description">The server has a bunch of hosts listed, but it needs to know what
     the default host is. This is also used as a convenient way to refer to this
     Server.
     </dd><dt class="description">
<span 
class="pplb7t-">bind</span><span 
class="pplb7t-">_addr</span> </dt><dd 
class="description">The IP address to bind to. By default, it&#8217;s &#8220;0.0.0.0&#8221;.
     </dd><dt class="description">
<span 
class="pplb7t-">port</span> </dt><dd 
class="description">The port the server should listen on for new connections.</dd></dl>
<!--l. 288--><p class="noindent" >
<h4 class="subsectionHead"><span class="titlemark">3.4.2    </span> <a 
 id="x6-270003.4.2"></a>Host</h4>
<!--l. 290--><p class="noindent" >A host is matched using a kind of <span 
class="pplri7t-">inverse route </span>that matches the ending of <span 
class="pcrro7t-">Host:</span>
headers against a pattern. You&#8217;ll see how this works when we talk about routes, but
for now you just need to know that request to the <span 
class="pcrro7t-">Server.port </span>are routed based
on these <span 
class="pcrro7t-">Host </span>configurations the <span 
class="pcrro7t-">Server </span>contains.
     <dl class="description"><dt class="description">
<span 
class="pplb7t-">name</span> </dt><dd 
class="description">The   name   that   you   use   to   talk   about   this   Host   in   the   server
     configuration.
     </dd><dt class="description">
<span 
class="pplb7t-">matching</span> </dt><dd 
class="description">This is a pattern that&#8217;s used to match incoming <span 
class="pcrro7t-">Host: </span>headers for
     routing purposes.
     </dd><dt class="description">
<span 
class="pplb7t-">server</span> </dt><dd 
class="description">If you want to set the server separately, you can use this attribute.
     </dd><dt class="description">
<span 
class="pplb7t-">maintenance</span> </dt><dd 
class="description">This  will  be  a  setting  for  the  future  that  will  let  you  have
     Mongrel2 throw up a maintenance page for this host.
     </dd><dt class="description">
<span 
class="pplb7t-">routes</span> </dt><dd 
class="description">This is a dict (hashmap) of the URL patterns mapped to the targets that
     should be run.</dd></dl>
                                                                  

                                                                  
<!--l. 305--><p class="noindent" >
<h4 class="subsectionHead"><span class="titlemark">3.4.3    </span> <a 
 id="x6-280003.4.3"></a>Route</h4>
<!--l. 307--><p class="noindent" >The <span 
class="pcrro7t-">Route </span>is the workhorse of the whole system. It uses some very fancy but still
simple code in Mongrel2 to translate <span 
class="pcrro7t-">Host: </span>headers to <span 
class="pcrro7t-">Hosts </span>and URL paths to
<span 
class="pcrro7t-">Handlers</span>, <span 
class="pcrro7t-">Dirs</span>, and <span 
class="pcrro7t-">Proxies</span>.
     <dl class="description"><dt class="description">
<span 
class="pplb7t-">path</span> </dt><dd 
class="description">This  is  the  path  <span 
class="pplri7t-">pattern  </span>that  matches  a  route.  The  pattern  uses  the
     Mongrel2 pattern language, which is a reduced version of the Lua pattern
     matching system.
     </dd><dt class="description">
<span 
class="pplb7t-">reversed</span> </dt><dd 
class="description">Determines if this pattern is reversed, which is useful for matching
     file extensions, hostnames, and other naming systems where the ending
     is really the prefix. Usually you don&#8217;t set this.
     </dd><dt class="description">
<span 
class="pplb7t-">host</span> </dt><dd 
class="description">You can use this attribute to set the host manually.
     </dd><dt class="description">
<span 
class="pplb7t-">target</span> </dt><dd 
class="description">This is the target that should handle the request, either a <span 
class="pcrro7t-">Dir</span>, <span 
class="pcrro7t-">Handler</span>
     or <span 
class="pcrro7t-">Proxy</span>.</dd></dl>
<!--l. 320--><p class="noindent" >Later on, you&#8217;ll learn about the pattern matching that&#8217;s used, but it&#8217;s basically a
stripped down version of your normal regular expressions, but with a few
convenient syntaxes for doing simple string matching. When you configure a route,
you write something like <span 
class="pcrb7t-">/images/(.&#x22C6;.jpg) </span>and the part before the &#8216;(&#8217; is used as
a fast matched prefix, while the part after it is considered a pattern to match. When a
request comes in, Mongrel2 quickly finds the longest prefix that matches the URL,
and then tests its pattern if there is one. If the pattern is valid, the request goes
through. If not, 404.
<!--l. 328--><p class="noindent" >
<h4 class="subsectionHead"><span class="titlemark">3.4.4    </span> <a 
 id="x6-290003.4.4"></a>Dir</h4>
<!--l. 330--><p class="noindent" >A <span 
class="pcrro7t-">Dir </span>is a simple directory-serving route target that serves files out of a directory. It
has caching built-in, handles if-modified-since, ETags, and all the various bizarre
HTTP caching mechanisms as RFC-accurately as possible. It also has default
content-types and index files.
                                                                  

                                                                  
     <dl class="description"><dt class="description">
<span 
class="pplb7t-">base</span> </dt><dd 
class="description">This is the base directory <span 
class="pplri7t-">from the chroot </span>that is served. Files should not be
     served outside of this base directory, even if they&#8217;re in the chroot.
     </dd><dt class="description">
<span 
class="pplb7t-">index</span><span 
class="pplb7t-">_file</span> </dt><dd 
class="description">This is the default index file to use if a request doesn&#8217;t give one.
     The <span 
class="pcrro7t-">Dir </span>also will do redirects if a request for a directory doesn&#8217;t end in a
     slash.
     </dd><dt class="description">
<span 
class="pplb7t-">default</span><span 
class="pplb7t-">_ctype</span> </dt><dd 
class="description">The   default   <span 
class="pcrro7t-">Content-Type </span>to   use   if   none   matches   the
     MIMEType table.</dd></dl>
<!--l. 342--><p class="noindent" >Currently, we don&#8217;t offer more parameters for configuration, but eventually
you&#8217;ll be able to tweak more and more of the settings to control how Dirs
work.
<!--l. 345--><p class="noindent" >
<h4 class="subsectionHead"><span class="titlemark">3.4.5    </span> <a 
 id="x6-300003.4.5"></a>Proxy</h4>
<!--l. 347--><p class="noindent" >A proxy is used so that you can use Mongrel2 but not have to throw out your
existing infrastructure. Mongrel2 goes to great pains to make sure that it implements
a fast and dead-accurate proxy system internally, but no matter how good it is, it
can&#8217;t compete with ZeroMQ handlers. The idea with giving Proxy functionality is
that you can point Mongrel2 at existing servers, and then slowly carve out pieces
that will work as handlers.
     <dl class="description"><dt class="description">
<span 
class="pplb7t-">addr</span> </dt><dd 
class="description">The DNS address of the server.
     </dd><dt class="description">
<span 
class="pplb7t-">port</span> </dt><dd 
class="description">The port to connect to.</dd></dl>
<!--l. 360--><p class="noindent" >Requests that match a Proxy route are still parsed by Mongrel2&#8217;s incredibly accurate
HTTP parser, so that your backend servers should not receive badly formatted HTTP
requests. Responses from a Proxy server, however, are sent unaltered to the browser
directly.
<!--l. 366--><p class="noindent" >
                                                                  

                                                                  
<h4 class="subsectionHead"><span class="titlemark">3.4.6    </span> <a 
 id="x6-310003.4.6"></a>Handler</h4>
<!--l. 368--><p class="noindent" >Now we get to the best part: the ZeroMQ Handlers that will receive asynchronous
requests from Mongrel2. You need to use the ZeroMQ syntax for configuring them,
but this means with one configuration format you can use handlers that are using
UDP, TCP, Unix, or PGM transports. Most testing has been done with TCP
transports.
     <dl class="description"><dt class="description">
<span 
class="pplb7t-">send</span><span 
class="pplb7t-">_spec</span> </dt><dd 
class="description">This                    is                    the                    0MQ                    sender
     specification. Something like <span class="obeylines-h"><span class="verb"><span 
class="pcrr7t-">tcp://127.0.0.1:9999</span></span></span> will use TCP to
     connect to a server on 127.0.0.1 at port 9999. The type of socket used is a
     PUSH socket, so that handlers receive messages in round-robin style.
     </dd><dt class="description">
<span 
class="pplb7t-">send</span><span 
class="pplb7t-">_ident</span> </dt><dd 
class="description">This is an identifier (usually a UUID) that will be used to register
     the  send  socket.  This  makes  it  so  that  messages  are  persisted  between
     crashes.
     </dd><dt class="description">
<span 
class="pplb7t-">recv</span><span 
class="pplb7t-">_spec</span> </dt><dd 
class="description">Same  as  the  send  spec,  but  it&#8217;s  for  receiving  responses  from
     Handlers. The type of socket used is a SUB socket, so that a cluster of
     Mongrel2 servers will receive handler responses but only the one with
     the right recv_ident will process it.
     </dd><dt class="description">
<span 
class="pplb7t-">recv</span><span 
class="pplb7t-">_ident</span> </dt><dd 
class="description">This is another UUID if you want the receive socket to subscribe to
     its messages. Handlers properly mention the send_ident on all returned
     messages, so you should either set this to nothing and don&#8217;t subscribe, or
     set it to the same as send_ident.</dd></dl>
<!--l. 387--><p class="noindent" >The interesting thing about the <span 
class="pcrro7t-">Handler </span>configuration is that you don&#8217;t have to say
where the actual backend handlers live. Did you notice you aren&#8217;t declaring large
clusters of proxies, proxy selection methods, or anything else, other than two 0MQ
endpoints and some identifiers? This is because Mongrel2 is <span 
class="pplri7t-">binding </span>these
sockets and listening. Mongrel2 doesn&#8217;t actively connect to backends; they
connect to Mongrel2. This means, if you want to fire up 10 more handlers, you
just start them; no need to restart or reconfigure Mongrel2 to make them
active.
<!--l. 395--><p class="noindent" >
<h4 class="subsectionHead"><span class="titlemark">3.4.7    </span> <a 
 id="x6-320003.4.7"></a>Others</h4>
<!--l. 397--><p class="noindent" >There&#8217;s also <span 
class="pcrro7t-">Log</span>, <span 
class="pcrro7t-">MIMEType</span>, and <span 
class="pcrro7t-">Setting </span>objects/tables you can work with, but
                                                                  

                                                                  
we&#8217;ll get into those later, since you don&#8217;t need to know about them to understand the
Mongrel2 structure.
<!--l. 403--><p class="noindent" >
<h3 class="sectionHead"><span class="titlemark">3.5    </span> <a 
 id="x6-330003.5"></a>A More Complex Example</h3>
<!--l. 405--><p class="noindent" >All of this knowledge about the Mongrel2 configuration structure can now be used
to take a look at a more complex example. We&#8217;ll take a look at this example and I&#8217;ll
just say what&#8217;s going on, and you try to match what I&#8217;m saying to the code. Here&#8217;s
the <span 
class="pcrb7t-">examples/configs/mongrel2.conf </span>file:
                                                                  

                                                                  
<!--l. 409--><p class="noindent" ><a 
 id="x6-33001r9"></a><hr class="float"><div class="float" 
>
                                                                  

                                                                  
 <div class="caption" 
><span class="id">Source 9: </span><span  
class="content">                                                                                      <span 
class="pplri7t-">Mongrel2.org Config</span>
<span 
class="pplri7t-">Script</span></span></div><!--tex4ht:label?: x6-33001r9 -->
<!--l. 410-->
<div class="lstlisting" id="listing-2"><span class="label"><a 
 id="x6-33002r1"></a></span><span 
class="pcrr7t-x-x-90">#</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">here</span><span 
class="pcrr8c-x-x-90">&#8217;</span><span 
class="pcrr7t-x-x-90">s</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">a</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">sample</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">directory</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-33003r2"></a></span><span 
class="pcrr7t-x-x-90">test_directory</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">=</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">Dir</span><span 
class="pcrr7t-x-x-90">(</span><span 
class="pcrr7t-x-x-90">base</span><span 
class="pcrr7t-x-x-90">=</span><span 
class="pcrr8c-x-x-90">&#8217;</span><span 
class="pcrr7t-x-x-90">tests</span><span 
class="pcrr7t-x-x-90">/</span><span 
class="pcrr8c-x-x-90">&#8217;</span><span 
class="pcrr7t-x-x-90">,</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-33004r3"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">index_file</span><span 
class="pcrr7t-x-x-90">=</span><span 
class="pcrr8c-x-x-90">&#8217;</span><span 
class="pcrr7t-x-x-90">index</span><span 
class="pcrr7t-x-x-90">.</span><span 
class="pcrr7t-x-x-90">html</span><span 
class="pcrr8c-x-x-90">&#8217;</span><span 
class="pcrr7t-x-x-90">,</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-33005r4"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">default_ctype</span><span 
class="pcrr7t-x-x-90">=</span><span 
class="pcrr8c-x-x-90">&#8217;</span><span 
class="pcrr7t-x-x-90">text</span><span 
class="pcrr7t-x-x-90">/</span><span 
class="pcrr7t-x-x-90">plain</span><span 
class="pcrr8c-x-x-90">&#8217;</span><span 
class="pcrr7t-x-x-90">)</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-33006r5"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-33007r6"></a></span><span 
class="pcrr7t-x-x-90">#</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">a</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">sample</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">proxy</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">route</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-33008r7"></a></span><span 
class="pcrr7t-x-x-90">web_app_proxy</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">=</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">Proxy</span><span 
class="pcrr7t-x-x-90">(</span><span 
class="pcrr7t-x-x-90">addr</span><span 
class="pcrr7t-x-x-90">=</span><span 
class="pcrr8c-x-x-90">&#8217;</span><span 
class="pcrr7t-x-x-90">127.0.0.1</span><span 
class="pcrr8c-x-x-90">&#8217;</span><span 
class="pcrr7t-x-x-90">,</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">port</span><span 
class="pcrr7t-x-x-90">=8080)</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-33009r8"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-33010r9"></a></span><span 
class="pcrr7t-x-x-90">chat_demo_dir</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">=</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">Dir</span><span 
class="pcrr7t-x-x-90">(</span><span 
class="pcrr7t-x-x-90">base</span><span 
class="pcrr7t-x-x-90">=</span><span 
class="pcrr8c-x-x-90">&#8217;</span><span 
class="pcrr7t-x-x-90">examples</span><span 
class="pcrr7t-x-x-90">/</span><span 
class="pcrr7t-x-x-90">chat</span><span 
class="pcrr7t-x-x-90">/</span><span 
class="pcrr7t-x-x-90">static</span><span 
class="pcrr7t-x-x-90">/</span><span 
class="pcrr8c-x-x-90">&#8217;</span><span 
class="pcrr7t-x-x-90">,</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-33011r10"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">index_file</span><span 
class="pcrr7t-x-x-90">=</span><span 
class="pcrr8c-x-x-90">&#8217;</span><span 
class="pcrr7t-x-x-90">index</span><span 
class="pcrr7t-x-x-90">.</span><span 
class="pcrr7t-x-x-90">html</span><span 
class="pcrr8c-x-x-90">&#8217;</span><span 
class="pcrr7t-x-x-90">,</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-33012r11"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">default_ctype</span><span 
class="pcrr7t-x-x-90">=</span><span 
class="pcrr8c-x-x-90">&#8217;</span><span 
class="pcrr7t-x-x-90">text</span><span 
class="pcrr7t-x-x-90">/</span><span 
class="pcrr7t-x-x-90">plain</span><span 
class="pcrr8c-x-x-90">&#8217;</span><span 
class="pcrr7t-x-x-90">)</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-33013r12"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-33014r13"></a></span><span 
class="pcrr7t-x-x-90">#</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">a</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">sample</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">of</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">doing</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">some</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">handlers</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-33015r14"></a></span><span 
class="pcrr7t-x-x-90">chat_demo</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">=</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">Handler</span><span 
class="pcrr7t-x-x-90">(</span><span 
class="pcrr7t-x-x-90">send_spec</span><span 
class="pcrr7t-x-x-90">=</span><span 
class="pcrr8c-x-x-90">&#8217;</span><span 
class="pcrr7t-x-x-90">tcp</span><span 
class="pcrr7t-x-x-90">://127.0.0.1:9999</span><span 
class="pcrr8c-x-x-90">&#8217;</span><span 
class="pcrr7t-x-x-90">,</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-33016r15"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">send_ident</span><span 
class="pcrr7t-x-x-90">=</span><span 
class="pcrr8c-x-x-90">&#8217;</span><span 
class="pcrr7t-x-x-90">54</span><span 
class="pcrr7t-x-x-90">c6755b</span><span 
class="pcrr7t-x-x-90">-9628-40</span><span 
class="pcrr7t-x-x-90">a4</span><span 
class="pcrr7t-x-x-90">-9</span><span 
class="pcrr7t-x-x-90">a2d</span><span 
class="pcrr7t-x-x-90">-</span><span 
class="pcrr7t-x-x-90">cc82a816345e</span><span 
class="pcrr8c-x-x-90">&#8217;</span><span 
class="pcrr7t-x-x-90">,</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-33017r16"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">recv_spec</span><span 
class="pcrr7t-x-x-90">=</span><span 
class="pcrr8c-x-x-90">&#8217;</span><span 
class="pcrr7t-x-x-90">tcp</span><span 
class="pcrr7t-x-x-90">://127.0.0.1:9998</span><span 
class="pcrr8c-x-x-90">&#8217;</span><span 
class="pcrr7t-x-x-90">,</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">recv_ident</span><span 
class="pcrr7t-x-x-90">=</span><span 
class="pcrr8c-x-x-90">&#8217;&#8217;</span><span 
class="pcrr7t-x-x-90">)</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-33018r17"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-33019r18"></a></span><span 
class="pcrr7t-x-x-90">handler_test</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">=</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">Handler</span><span 
class="pcrr7t-x-x-90">(</span><span 
class="pcrr7t-x-x-90">send_spec</span><span 
class="pcrr7t-x-x-90">=</span><span 
class="pcrr8c-x-x-90">&#8217;</span><span 
class="pcrr7t-x-x-90">tcp</span><span 
class="pcrr7t-x-x-90">://127.0.0.1:9997</span><span 
class="pcrr8c-x-x-90">&#8217;</span><span 
class="pcrr7t-x-x-90">,</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-33020r19"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">send_ident</span><span 
class="pcrr7t-x-x-90">=</span><span 
class="pcrr8c-x-x-90">&#8217;</span><span 
class="pcrr7t-x-x-90">34</span><span 
class="pcrr7t-x-x-90">f9ceee</span><span 
class="pcrr7t-x-x-90">-</span><span 
class="pcrr7t-x-x-90">cd52</span><span 
class="pcrr7t-x-x-90">-4</span><span 
class="pcrr7t-x-x-90">b7f</span><span 
class="pcrr7t-x-x-90">-</span><span 
class="pcrr7t-x-x-90">b197</span><span 
class="pcrr7t-x-x-90">-88</span><span 
class="pcrr7t-x-x-90">bf2f0ec378</span><span 
class="pcrr8c-x-x-90">&#8217;</span><span 
class="pcrr7t-x-x-90">,</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-33021r20"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">recv_spec</span><span 
class="pcrr7t-x-x-90">=</span><span 
class="pcrr8c-x-x-90">&#8217;</span><span 
class="pcrr7t-x-x-90">tcp</span><span 
class="pcrr7t-x-x-90">://127.0.0.1:9996</span><span 
class="pcrr8c-x-x-90">&#8217;</span><span 
class="pcrr7t-x-x-90">,</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">recv_ident</span><span 
class="pcrr7t-x-x-90">=</span><span 
class="pcrr8c-x-x-90">&#8217;&#8217;</span><span 
class="pcrr7t-x-x-90">)</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-33022r21"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-33023r22"></a></span><span 
class="pcrr7t-x-x-90">#</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">your</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">main</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">host</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-33024r23"></a></span><span 
class="pcrr7t-x-x-90">mongrel2</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">=</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">Host</span><span 
class="pcrr7t-x-x-90">(</span><span 
class="pcrr7t-x-x-90">name</span><span 
class="pcrr7t-x-x-90">="</span><span 
class="pcrr7t-x-x-90">mongrel2</span><span 
class="pcrr7t-x-x-90">.</span><span 
class="pcrr7t-x-x-90">org</span><span 
class="pcrr7t-x-x-90">",</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">routes</span><span 
class="pcrr7t-x-x-90">={</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-33025r24"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr8c-x-x-90">&#8217;</span><span 
class="pcrr7t-x-x-90">@chat</span><span 
class="pcrr8c-x-x-90">&#8217;</span><span 
class="pcrr7t-x-x-90">:</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">chat_demo</span><span 
class="pcrr7t-x-x-90">,</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-33026r25"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr8c-x-x-90">&#8217;</span><span 
class="pcrr7t-x-x-90">/</span><span 
class="pcrr7t-x-x-90">handlertest</span><span 
class="pcrr8c-x-x-90">&#8217;</span><span 
class="pcrr7t-x-x-90">:</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">handler_test</span><span 
class="pcrr7t-x-x-90">,</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-33027r26"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr8c-x-x-90">&#8217;</span><span 
class="pcrr7t-x-x-90">/</span><span 
class="pcrr7t-x-x-90">chat</span><span 
class="pcrr7t-x-x-90">/</span><span 
class="pcrr8c-x-x-90">&#8217;</span><span 
class="pcrr7t-x-x-90">:</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">web_app_proxy</span><span 
class="pcrr7t-x-x-90">,</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-33028r27"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr8c-x-x-90">&#8217;</span><span 
class="pcrr7t-x-x-90">/</span><span 
class="pcrr8c-x-x-90">&#8217;</span><span 
class="pcrr7t-x-x-90">:</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">web_app_proxy</span><span 
class="pcrr7t-x-x-90">,</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-33029r28"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr8c-x-x-90">&#8217;</span><span 
class="pcrr7t-x-x-90">/</span><span 
class="pcrr7t-x-x-90">tests</span><span 
class="pcrr7t-x-x-90">/</span><span 
class="pcrr8c-x-x-90">&#8217;</span><span 
class="pcrr7t-x-x-90">:</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">test_directory</span><span 
class="pcrr7t-x-x-90">,</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-33030r29"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr8c-x-x-90">&#8217;</span><span 
class="pcrr7t-x-x-90">/</span><span 
class="pcrr7t-x-x-90">testsmulti</span><span 
class="pcrr7t-x-x-90">/(.&#x22C6;\.</span><span 
class="pcrr7t-x-x-90">json</span><span 
class="pcrr7t-x-x-90">)</span><span 
class="pcrr8c-x-x-90">&#8217;</span><span 
class="pcrr7t-x-x-90">:</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">test_directory</span><span 
class="pcrr7t-x-x-90">,</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-33031r30"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr8c-x-x-90">&#8217;</span><span 
class="pcrr7t-x-x-90">/</span><span 
class="pcrr7t-x-x-90">chatdemo</span><span 
class="pcrr7t-x-x-90">/</span><span 
class="pcrr8c-x-x-90">&#8217;</span><span 
class="pcrr7t-x-x-90">:</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">chat_demo_dir</span><span 
class="pcrr7t-x-x-90">,</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-33032r31"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr8c-x-x-90">&#8217;</span><span 
class="pcrr7t-x-x-90">/</span><span 
class="pcrr7t-x-x-90">static</span><span 
class="pcrr7t-x-x-90">/</span><span 
class="pcrr8c-x-x-90">&#8217;</span><span 
class="pcrr7t-x-x-90">:</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">chat_demo_dir</span><span 
class="pcrr7t-x-x-90">,</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-33033r32"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr8c-x-x-90">&#8217;</span><span 
class="pcrr7t-x-x-90">/</span><span 
class="pcrr7t-x-x-90">mp3stream</span><span 
class="pcrr8c-x-x-90">&#8217;</span><span 
class="pcrr7t-x-x-90">:</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">Handler</span><span 
class="pcrr7t-x-x-90">(</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-33034r33"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">send_spec</span><span 
class="pcrr7t-x-x-90">=</span><span 
class="pcrr8c-x-x-90">&#8217;</span><span 
class="pcrr7t-x-x-90">tcp</span><span 
class="pcrr7t-x-x-90">://127.0.0.1:9995</span><span 
class="pcrr8c-x-x-90">&#8217;</span><span 
class="pcrr7t-x-x-90">,</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-33035r34"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">send_ident</span><span 
class="pcrr7t-x-x-90">=</span><span 
class="pcrr8c-x-x-90">&#8217;</span><span 
class="pcrr7t-x-x-90">53</span><span 
class="pcrr7t-x-x-90">f9f1d1</span><span 
class="pcrr7t-x-x-90">-1116-4751-</span><span 
class="pcrr7t-x-x-90">b6ff</span><span 
class="pcrr7t-x-x-90">-4</span><span 
class="pcrr7t-x-x-90">fbe3e43d142</span><span 
class="pcrr8c-x-x-90">&#8217;</span><span 
class="pcrr7t-x-x-90">,</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-33036r35"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">recv_spec</span><span 
class="pcrr7t-x-x-90">=</span><span 
class="pcrr8c-x-x-90">&#8217;</span><span 
class="pcrr7t-x-x-90">tcp</span><span 
class="pcrr7t-x-x-90">://127.0.0.1:9994</span><span 
class="pcrr8c-x-x-90">&#8217;</span><span 
class="pcrr7t-x-x-90">,</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">recv_ident</span><span 
class="pcrr7t-x-x-90">=</span><span 
class="pcrr8c-x-x-90">&#8217;&#8217;</span><span 
class="pcrr7t-x-x-90">)</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-33037r36"></a></span><span 
class="pcrr7t-x-x-90">})</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-33038r37"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-33039r38"></a></span><span 
class="pcrr7t-x-x-90">#</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">the</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">server</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">to</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">run</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">them</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">all</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-33040r39"></a></span><span 
class="pcrr7t-x-x-90">main</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">=</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">Server</span><span 
class="pcrr7t-x-x-90">(</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-33041r40"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">uuid</span><span 
class="pcrr7t-x-x-90">="2</span><span 
class="pcrr7t-x-x-90">f62bd5</span><span 
class="pcrr7t-x-x-90">-9</span><span 
class="pcrr7t-x-x-90">e59</span><span 
class="pcrr7t-x-x-90">-49</span><span 
class="pcrr7t-x-x-90">cd</span><span 
class="pcrr7t-x-x-90">-993</span><span 
class="pcrr7t-x-x-90">c</span><span 
class="pcrr7t-x-x-90">-3</span><span 
class="pcrr7t-x-x-90">b6013c28f05</span><span 
class="pcrr7t-x-x-90">",</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-33042r41"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">access_log</span><span 
class="pcrr7t-x-x-90">="/</span><span 
class="pcrr7t-x-x-90">logs</span><span 
class="pcrr7t-x-x-90">/</span><span 
class="pcrr7t-x-x-90">access</span><span 
class="pcrr7t-x-x-90">.</span><span 
class="pcrr7t-x-x-90">log</span><span 
class="pcrr7t-x-x-90">",</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-33043r42"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">error_log</span><span 
class="pcrr7t-x-x-90">="/</span><span 
class="pcrr7t-x-x-90">logs</span><span 
class="pcrr7t-x-x-90">/</span><span 
class="pcrr7t-x-x-90">error</span><span 
class="pcrr7t-x-x-90">.</span><span 
class="pcrr7t-x-x-90">log</span><span 
class="pcrr7t-x-x-90">",</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-33044r43"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">chroot</span><span 
class="pcrr7t-x-x-90">="./",</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-33045r44"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">pid_file</span><span 
class="pcrr7t-x-x-90">="/</span><span 
class="pcrr7t-x-x-90">run</span><span 
class="pcrr7t-x-x-90">/</span><span 
class="pcrr7t-x-x-90">mongrel2</span><span 
class="pcrr7t-x-x-90">.</span><span 
class="pcrr7t-x-x-90">pid</span><span 
class="pcrr7t-x-x-90">",</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-33046r45"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">default_host</span><span 
class="pcrr7t-x-x-90">="</span><span 
class="pcrr7t-x-x-90">mongrel2</span><span 
class="pcrr7t-x-x-90">.</span><span 
class="pcrr7t-x-x-90">org</span><span 
class="pcrr7t-x-x-90">",</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-33047r46"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">name</span><span 
class="pcrr7t-x-x-90">="</span><span 
class="pcrr7t-x-x-90">main</span><span 
class="pcrr7t-x-x-90">",</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-33048r47"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">port</span><span 
class="pcrr7t-x-x-90">=6767,</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-33049r48"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">filters</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">=</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">[],</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-33050r49"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">hosts</span><span 
class="pcrr7t-x-x-90">=[</span><span 
class="pcrr7t-x-x-90">mongrel2</span><span 
class="pcrr7t-x-x-90">]</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-33051r50"></a></span><span 
class="pcrr7t-x-x-90">)</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-33052r51"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-33053r52"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-33054r53"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-33055r54"></a></span><span 
class="pcrr7t-x-x-90">settings</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">=</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">{"</span><span 
class="pcrr7t-x-x-90">zeromq</span><span 
class="pcrr7t-x-x-90">.</span><span 
class="pcrr7t-x-x-90">threads</span><span 
class="pcrr7t-x-x-90">":</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">1,</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">"</span><span 
class="pcrr7t-x-x-90">upload</span><span 
class="pcrr7t-x-x-90">.</span><span 
class="pcrr7t-x-x-90">temp_store</span><span 
class="pcrr7t-x-x-90">":</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-33056r55"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">"/</span><span 
class="pcrr7t-x-x-90">home</span><span 
class="pcrr7t-x-x-90">/</span><span 
class="pcrr7t-x-x-90">zedshaw</span><span 
class="pcrr7t-x-x-90">/</span><span 
class="pcrr7t-x-x-90">projects</span><span 
class="pcrr7t-x-x-90">/</span><span 
class="pcrr7t-x-x-90">mongrel2</span><span 
class="pcrr7t-x-x-90">/</span><span 
class="pcrr7t-x-x-90">tmp</span><span 
class="pcrr7t-x-x-90">/</span><span 
class="pcrr7t-x-x-90">upload</span><span 
class="pcrr7t-x-x-90">.</span><span 
class="pcrr7t-x-x-90">XXXXXX</span><span 
class="pcrr7t-x-x-90">",</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-33057r56"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">"</span><span 
class="pcrr7t-x-x-90">upload</span><span 
class="pcrr7t-x-x-90">.</span><span 
class="pcrr7t-x-x-90">temp_store_mode</span><span 
class="pcrr7t-x-x-90">":</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">"0666"</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-33058r57"></a></span><span 
class="pcrr7t-x-x-90">}</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-33059r58"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-33060r59"></a></span><span 
class="pcrr7t-x-x-90">servers</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">=</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">[</span><span 
class="pcrr7t-x-x-90">main</span><span 
class="pcrr7t-x-x-90">]</span>
</div>
                                                                  

                                                                  
</div><hr class="endfloat" />
<!--l. 474--><p class="noindent" >If you haven&#8217;t guessed yet, this configuration is what&#8217;s used on <a 
href="http://mongrel2.org" class="url" ><span 
class="pcrr7t-">http://mongrel2.org</span></a>
to configure the main test system. In it we&#8217;ve got the following things to check
out:
     <ol  class="enumerate1" >
     <li 
  class="enumerate" id="x6-33064x1">Our basic server, with a default host of mongrel2.org.
     </li>
     <li 
  class="enumerate" id="x6-33066x2">The route targets are separated out into their own variables, unlike the
     <span 
class="pcrb7t-">sample</span><span 
class="pcrb7t-">_conf.py </span>file where they&#8217;re just tossed into one big structure.
     </li>
     <li 
  class="enumerate" id="x6-33068x3">First target is a <span 
class="pcrro7t-">Dir </span>that serves up files out of the <span 
class="pcrb7t-">tests </span>directory and
     uses <span 
class="pcrb7t-">index.html </span>as its default file.
     </li>
     <li 
  class="enumerate" id="x6-33070x4">Next we setup a <span 
class="pcrro7t-">Proxy </span>pointing at the main website&#8217;s server for testing
     the proxy.
     </li>
     <li 
  class="enumerate" id="x6-33072x5">Then                 there&#8217;s                 a                 <span 
class="pcrro7t-">Dir       </span>target                 for
     the <a 
href="http://mongrel2.org:6767/chatdemo/" class="url" ><span 
class="pcrr7t-">http://mongrel2.org:6767/chatdemo/</span></a> that we&#8217;ll look at later.
     <span 
class="pplri7t-">You MUST have flash for this to work!</span>
     </li>
     <li 
  class="enumerate" id="x6-33074x6">And you have the <span 
class="pcrro7t-">Handler </span>for the same chat demo that does the actual
     logic of a chat system.
     </li>
     <li 
  class="enumerate" id="x6-33076x7">After  that&#8217;s  a  little  <span 
class="pcrro7t-">Handler </span>for  testing  out  doing  HTTP  requests  to  a
     handler.  Notice  how  even  though  the  chat  demo  and  this  handler  use
     different  protocols  (chat  demo  is  using  JSSockets)  you  don&#8217;t  have  tell
     mongrel2 that? It figures it out based on how they&#8217;re being used rather
     than by configurations.
     </li>
     <li 
  class="enumerate" id="x6-33078x8">With all those handler targets, we can now make the <span 
class="pcrro7t-">mongrel2 Host</span>
     with all the routes assigned once, nice and clean. However, look how I
     was lazy and just tossed the mp3stream demo right into the routes dict?
     You can totally do this and m2sh will figure it out. Remember also that
     you can use the <span class="obeylines-h"><span class="verb"><span 
class="pcrr7t-">'blah'</span></span></span> string format to not have to double up on your
     <span class="obeylines-h"><span class="verb"><span 
class="pcrr7t-">\</span></span></span> chars in the patterns.
     </li>
     <li 
  class="enumerate" id="x6-33080x9">We then assign this <span 
class="pcrro7t-">mongrel2 </span>variable as the hosts for the <span 
class="pcrro7t-">main </span>server.
     </li>
     <li 
  class="enumerate" id="x6-33082x10">There is also a <span 
class="pcrro7t-">settings </span>feature, which is just a dict of global settings
                                                                  

                                                                  
     you  can  tweak.  In  this  case,  we&#8217;re  upping  the  number  of  threads  that
     0MQ is using for its operations.
     </li>
     <li 
  class="enumerate" id="x6-33084x11">Finally,  we  commit  the  whole  thing  to  the  database  by  passing  in  the
     servers to save and the settings to use.</li></ol>
<!--l. 500--><p class="noindent" >And that, my friends, is the most complex configuration we have so far.
<h3 class="sectionHead"><span class="titlemark">3.6    </span> <a 
 id="x6-340003.6"></a>Routing And Host Patterns</h3>
<!--l. 505--><p class="noindent" >The pattern code was taken from <a 
href="http://www.lua.org/" >Lua</a> and is some of the simplest code for doing fast
pattern matches. It is very much like regular expressions, except it removes a lot of
features you don&#8217;t need for routes. Also, unlike regular expressions, URL patterns
always match from the start. Mongrel2 uses them by breaking routes up into a prefix
and pattern part. It then uses routes to find the longest matching prefix
and then tests the pattern. If the pattern matches, then the route works. If
the route doesn&#8217;t have a pattern, then it&#8217;s assumed to match, and you&#8217;re
done.
<!--l. 514--><p class="noindent" >The only caveat is that you have to wrap your pattern parts in parenthesis, but these
don&#8217;t mean anything other than to delimit where a pattern starts. So instead of
<span 
class="pcrro7t-">/images/.&#x22C6;.jpg</span>, write <span 
class="pcrro7t-">/images/(.&#x22C6;.jpg) </span>for it to work.
<!--l. 518--><p class="noindent" >Here&#8217;s the list of characters you can use in your patterns:
     <ul class="itemize1">
     <li class="itemize"><span class="obeylines-h"><span class="verb"><span 
class="pcrr7t-">.</span></span></span> (period) All characters.
     </li>
     <li class="itemize"><span class="obeylines-h"><span class="verb"><span 
class="pcrr7t-">\a</span></span></span> Letters.
     </li>
     <li class="itemize"><span class="obeylines-h"><span class="verb"><span 
class="pcrr7t-">\c</span></span></span> Control characters.
     </li>
     <li class="itemize"><span class="obeylines-h"><span class="verb"><span 
class="pcrr7t-">\d</span></span></span> Digits.
     </li>
     <li class="itemize"><span class="obeylines-h"><span class="verb"><span 
class="pcrr7t-">\l</span></span></span> Lowercase letters.
     </li>
     <li class="itemize"><span class="obeylines-h"><span class="verb"><span 
class="pcrr7t-">\p</span></span></span> Punctuation characters.
     </li>
     <li class="itemize"><span class="obeylines-h"><span class="verb"><span 
class="pcrr7t-">\s</span></span></span> Space characters.
                                                                  

                                                                  
     </li>
     <li class="itemize"><span class="obeylines-h"><span class="verb"><span 
class="pcrr7t-">\u</span></span></span> Uppercase letters.
     </li>
     <li class="itemize"><span class="obeylines-h"><span class="verb"><span 
class="pcrr7t-">\w</span></span></span> Alphanumeric characters.
     </li>
     <li class="itemize"><span class="obeylines-h"><span class="verb"><span 
class="pcrr7t-">\x</span></span></span> Hexadecimal digits.
     </li>
     <li class="itemize"><span class="obeylines-h"><span class="verb"><span 
class="pcrr7t-">\z</span></span></span> The <span class="obeylines-h"><span class="verb"><span 
class="pcrr7t-">\0</span></span></span> character (null terminator).
     </li>
     <li class="itemize"><span class="obeylines-h"><span class="verb"><span 
class="pcrr7t-">[set]</span></span></span> Just like a regex&#8217;s [] where <span 
class="pplri7t-">set </span>is a set of chars, like [0-9] for all
     digits.
     </li>
     <li class="itemize"><span class="obeylines-h"><span class="verb"><span 
class="pcrr7t-">[^set]</span></span></span> Inverse character set, so <span class="obeylines-h"><span class="verb"><span 
class="pcrr7t-">[^0-9]</span></span></span> is anything but digits.
     </li>
     <li class="itemize"><span class="obeylines-h"><span class="verb"><span 
class="pcrr7t-">&#x22C6;</span></span></span> Longest match of 0 or more of the preceding character.
     </li>
     <li class="itemize"><span class="obeylines-h"><span class="verb"><span 
class="pcrr7t-">+</span></span></span> Longest match of 1 or more of the preceding character.
     </li>
     <li class="itemize"><span class="obeylines-h"><span class="verb"><span 
class="pcrr7t-">-</span></span></span> Shortest match of 0 or more of the preceding character.
     </li>
     <li class="itemize"><span class="obeylines-h"><span class="verb"><span 
class="pcrr7t-">?</span></span></span> 0 or 1 match of of the preceding character
     </li>
     <li class="itemize"><span class="obeylines-h"><span class="verb"><span 
class="pcrr7t-">\b</span></span></span><span 
class="pplri7t-">xy </span>Balanced match a substring starting with <span 
class="pplri7t-">x </span>and ending in <span 
class="pplri7t-">y</span>. So <span class="obeylines-h"><span class="verb"><span 
class="pcrr7t-">\b()</span></span></span>
     will match balanced parentheses.
     </li>
     <li class="itemize"><span class="obeylines-h"><span class="verb"><span 
class="pcrr7t-">$</span></span></span> End of the string.</li></ul>
<!--l. 543--><p class="noindent" >Using the uppercase version of an escaped character makes it work the opposite way
(e.g., <span class="obeylines-h"><span class="verb"><span 
class="pcrr7t-">\A</span></span></span> matches any character that <span 
class="pplri7t-">isn&#8217;t </span>a letter). The backslash can be used to
escape the following character, disabling its special abilities (e.g., <span class="obeylines-h"><span class="verb"><span 
class="pcrr7t-">\\</span></span></span> will match a
backslash).
<!--l. 548--><p class="noindent" >Anything that&#8217;s not listed here is matched literally.
                                                                  

                                                                  
<!--l. 550--><p class="noindent" ><a 
 id="x6-34001r4"></a><hr class="float"><div class="float" 
>
                                                                  

                                                                  
 <div class="caption" 
><span class="id">Note 4: </span><span  
class="content">                                                                                 <span 
class="pplri7t-">Sorry, Unicodians, It&#8217;s All</span>
<span 
class="pplri7t-">ASCII</span></span></div><!--tex4ht:label?: x6-34001r4 -->
     <div class="quote">
     <!--l. 551--><p class="indent" >   Yep, I get it. You think that everyone should use UTF-8 or some
     Unicode  encoding  for  everything.  You  despise  the  dominance  of
     the &#8216;A&#8217; in ASCII and hate that you can&#8217;t put your spoken language
     right in a URL.
     <!--l. 555--><p class="indent" >   Well, I hate to say it, but tough. Protocols are hard enough without
     having to worry about the bewildering mess that is Unicode. When
     you sit down to write a network protocol, the last thing you need
     is a format that&#8217;s inconsistent, has multiple interpretations, can&#8217;t be
     properly capitalized or lowercased, and requires extra translation
     steps for every operation. With ASCII, every computer just knows
     what it is, and it&#8217;s the fastest for creating wire protocol formats.
     <!--l. 563--><p class="indent" >   This  is  why,  on  the  Internet,  you  have  to  do  things  to  URLs  to
     make  them  ASCII,  like  encoding  them  with  %  signs.  It&#8217;s  in  the
     standard,  and  it&#8217;s  the  smart  thing  to  do.  I  don&#8217;t  want  to  have  to
     know  the  difference  between  the  various  accents  in  your  spoken
     language to route a URL around. I just want to deal with a fixed set
     of characters and be done with it. Don&#8217;t blame me or Mongrel2 for
     this, it&#8217;s just the way the standard is and the way to get a server that
     is stable and works.
     <!--l. 571--><p class="indent" >   Protocols  work  better  when  there&#8217;s  less  politics  in  their  design.
     This means you can&#8217;t put Unicode into your URL patterns. I mean,
     you can try; but the behavior is completely undefined. </div>
                                                                  

                                                                  
</div><hr class="endfloat" />
<!--l. 577--><p class="noindent" >Here are some example routes you can try to get a feel for the system:
     <ul class="itemize1">
     <li class="itemize"><span class="obeylines-h"><span class="verb"><span 
class="pcrr7t-">"/images/"</span></span></span> This  will  just  match  any  path  that  has  /images/  in  it
     without any patterns.
     </li>
     <li class="itemize"><span class="obeylines-h"><span class="verb"><span 
class="pcrr7t-">"/"</span></span></span> The fastest possible route you can have.
     </li>
     <li class="itemize"><span class="obeylines-h"><span class="verb"><span 
class="pcrr7t-">"/images/(.&#x22C6;.jpg)"</span></span></span> Match  only  requests  for  jpg  images  in  the
     images  directory.  Keep  in  mind  that  this  isn&#8217;t  actually  looking  in  the
     directory, it&#8217;s just matching the <span 
class="pcrro7t-">(.&#x22C6;.jpg) </span>pattern.
     </li>
     <li class="itemize"><span class="obeylines-h"><span class="verb"><span 
class="pcrr7t-">"/images/(\a-\-\d+\.jpg)"</span></span></span>                           A
     more complex example that matches a short sequence of 0 or more letters
     (remember -), then a dash (<span class="obeylines-h"><span class="verb"><span 
class="pcrr7t-">\-</span></span></span> escapes the -), then 1 or long sequence of
     digits and finally a .jpg) with the <span class="obeylines-h"><span class="verb"><span 
class="pcrr7t-">\</span></span></span>. escaping the period.</li></ul>
<!--l. 588--><p class="noindent" >That should give the idea of how you can use them. Notice also that I&#8217;m using the
Python <span class="obeylines-h"><span class="verb"><span 
class="pcrr7t-">"blah"</span></span></span> string syntax which is interchangeable with the <span class="obeylines-h"><span class="verb"><span 
class="pcrr7t-">'blah'</span></span></span> syntax so I
don&#8217;t have to double escape everything.
<h4 class="subsectionHead"><span class="titlemark">3.6.1    </span> <a 
 id="x6-350003.6.1"></a>How Routing Works</h4>
<!--l. 593--><p class="noindent" >The routing algorithm is actually kind of simple, but it&#8217;s an unfamiliar algorithm to
most programmers. I won&#8217;t go into the details of how a &#8220;Ternary Search Tree&#8221; works,
but basically it lets you match one prefix against a bunch of other strings very fast.
This data structure lets Mongrel2 very quickly determine the target for a route, and
also know if it has a route at all. Typically, it can match a route in just a few
characters, and reject a route in even fewer.
<!--l. 600--><p class="noindent" >For practical usage, it&#8217;s better to just read how it works, rather than how it&#8217;s
implemented. Here&#8217;s how Mongrel2 matches an incoming URL against routes
you&#8217;ve given it:
<!--l. 604--><p class="noindent" >
     <ol  class="enumerate1" >
     <li 
  class="enumerate" id="x6-35002x1">Your   configuration   has   a   route   for   <span class="obeylines-h"><span class="verb"><span 
class="pcrr7t-">"/images/(.&#x22C6;.jpg)"</span></span></span> and
     <span class="obeylines-h"><span class="verb"><span 
class="pcrr7t-">"/users"</span></span></span>.
     </li>
     <li 
  class="enumerate" id="x6-35004x2">Mongrel2 loads these and converts them to PREFIX/PATTERN pairs. For
                                                                  

                                                                  
     the first one the PREFIX=&#8221;images&#8221;, PATTERN=&#8221;(.*.jpg)&#8221;. For the second
     one, it&#8217;s PREFIX=&#8221;/users&#8221; and PATTERN=None.
     </li>
     <li 
  class="enumerate" id="x6-35006x3">It stores these in the URL routes by their PREFIX, and there can be only
     one  PREFIX  at  a  time.  This  means  you  can&#8217;t  put  <span class="obeylines-h"><span class="verb"><span 
class="pcrr7t-">"/foo/(.&#x22C6;)"</span></span></span> and
     <span class="obeylines-h"><span class="verb"><span 
class="pcrr7t-">"/foo/"</span></span></span> in at the same time (that&#8217;s always redundant anyway).
     </li>
     <li 
  class="enumerate" id="x6-35008x4">A  request  comes  in  for  <span class="obeylines-h"><span class="verb"><span 
class="pcrr7t-">/images/hello.jpg</span></span></span> so  Mongrel2  takes  the
     whole  URL  and  searches  for  the  longest  first  route  that  can  possibly
     match. In this case, that&#8217;s the <span class="obeylines-h"><span class="verb"><span 
class="pcrr7t-">/images</span></span></span> route.
     </li>
     <li 
  class="enumerate" id="x6-35010x5">It checks if the route it found has a pattern, and if it does then it runs
     the pattern match code for the whole thing. If they match, then this is the
     target and it&#8217;s good. If not, it returns a 404. In this case the /images URL
     and patterns match so it&#8217;s good.
     </li>
     <li 
  class="enumerate" id="x6-35012x6">Next, a request comes in for /users/johndoe/1234.
     </li>
     <li 
  class="enumerate" id="x6-35014x7">Mongrel2 does the PREFIX search again, and the longest matching prefix
     is the route for <span class="obeylines-h"><span class="verb"><span 
class="pcrr7t-">"/users"</span></span></span> so it gets that from the routing table.
     </li>
     <li 
  class="enumerate" id="x6-35016x8">Since the /users route doesn&#8217;t have a PATTERN, then this is the route
     and it passes by default. No pattern matching code is run.
     </li>
     <li 
  class="enumerate" id="x6-35018x9">Now for a slightly confusing result: A request comes in for /us. Since
     a PREFIX for <span class="obeylines-h"><span class="verb"><span 
class="pcrr7t-">"/users"</span></span></span> exists, and it&#8217;s the longest &#8221;first&#8221; match, it will
     match that route. If you wanted this condition to fail, you&#8217;d need to be
     explicit  and  add  on  a  pattern  like,  <span class="obeylines-h"><span class="verb"><span 
class="pcrr7t-">"/users()$"</span></span></span> to  say  you  need  an
     exact match. Another option is to give a <span class="obeylines-h"><span class="verb"><span 
class="pcrr7t-">"/"</span></span></span> route for a default location
     (which usually happens).
     </li>
     <li 
  class="enumerate" id="x6-35020x10">Finally, a request comes in for /XRAY. This will match no prefix at all, so
     it gets a 404.</li></ol>
<!--l. 633--><p class="noindent" >That example should show you how routes work, and the important thing to realize
is that they&#8217;ll try to match the &#8220;longest first route&#8221; as what we call the &#8220;best&#8221; route. If
you get unexpected routing behavior, then you&#8217;ll want to just make them explicit by
putting a pattern at the end.
<!--l. 638--><p class="noindent" >Finally, here&#8217;s some examples directly from the unit test that we have for the routing
system. Imagine we have these routes:
                                                                  

                                                                  
     <ul class="itemize1">
     <li class="itemize"><span class="obeylines-h"><span class="verb"><span 
class="pcrr7t-">"/"</span></span></span> == handler0
     </li>
     <li class="itemize"><span class="obeylines-h"><span class="verb"><span 
class="pcrr7t-">"/users/([0-9]+)"</span></span></span> == handler1
     </li>
     <li class="itemize"><span class="obeylines-h"><span class="verb"><span 
class="pcrr7t-">"/users"</span></span></span> == handler2
     </li>
     <li class="itemize"><span class="obeylines-h"><span class="verb"><span 
class="pcrr7t-">"/users/people/([0-9]+)$"</span></span></span> == handler3
     </li>
     <li class="itemize"><span class="obeylines-h"><span class="verb"><span 
class="pcrr7t-">"/cars-fast/([a-z]-)$"</span></span></span> == handler4</li></ul>
<!--l. 649--><p class="noindent" >Then this is how a set of example requests would match:
     <ul class="itemize1">
     <li class="itemize">/users/1234/testing - handler1
     </li>
     <li class="itemize">/users - handler2
     </li>
     <li class="itemize">/users/people/1234 - handler3
     </li>
     <li class="itemize">/cars-fast/cadillac - handler4
     </li>
     <li class="itemize">/users/1234 - handler1
     </li>
     <li class="itemize">/ - handler0
     </li>
     <li class="itemize">/usersBLAHAHAHAHA - handler2
     </li>
     <li class="itemize">/us - handler2</li></ul>
<!--l. 662--><p class="noindent" >Work through those in your head so you make sure you understand them.
<!--l. 664--><p class="noindent" >
<h4 class="subsectionHead"><span class="titlemark">3.6.2    </span> <a 
 id="x6-360003.6.2"></a>JSON/XML Message Routing Syntax</h4>
                                                                  

                                                                  
<!--l. 666--><p class="noindent" >Mongrel2 works with Flash sockets out of the box (with WebSockets coming soon)
and can handle either XML messages or special JSON messages. It does this by
modifying the parser it has internally to parse out HTTP or (exclusive) XML and
JSON messages. This feature can be used by any TCP client, not just Flash, it just
happens to be a simple way to send simple async messages without using
HTTP.
<!--l. 672--><p class="noindent" >To make it work, there&#8217;s a slight modification to the routes used by JSON or XML
messages. Basically, JSON routes start with a <span class="obeylines-h"><span class="verb"><span 
class="pcrr7t-">'@'</span></span></span> and XML routes start with a <span class="obeylines-h"><span class="verb"><span 
class="pcrr7t-">'&#x003C;'</span></span></span>
and both must be terminated with a NUL byte <span class="obeylines-h"><span class="verb"><span 
class="pcrr7t-">'\0'</span></span></span>. When the parser sees these at
the beginning of a request, it parses that message and sends it &#8220;as-is&#8221; to your target
handler.
<!--l. 678--><p class="noindent" >Let&#8217;s look at two examples from the chat demo and from some test suites:
     <ul class="itemize1">
     <li class="itemize"><span class="obeylines-h"><span class="verb"><span 
class="pcrr7t-">"@chat":</span><span 
class="pcrr7t-">&#x00A0;chat_demo</span></span></span>
     </li>
     <li class="itemize"><span class="obeylines-h"><span class="verb"><span 
class="pcrr7t-">"&#x003C;test":</span><span 
class="pcrr7t-">&#x00A0;xml_demo</span></span></span></li></ul>
<!--l. 685--><p class="noindent" >The first one will take any Flash (or just TCP connection) that sends lines
like <span class="obeylines-h"><span class="verb"><span 
class="pcrr7t-">@chat</span><span 
class="pcrr7t-">&#x00A0;{"msg":</span><span 
class="pcrr7t-">&#x00A0;"hello"}\0</span></span></span> and route those to the <span 
class="pcrro7t-">chat</span><span 
class="pcrro7t-">_demo</span>
handler. You can connect, and then just stream these JSON messages all you
want, and handlers can send back the same responses. In fact, as long as
you don&#8217;t include a <span class="obeylines-h"><span class="verb"><span 
class="pcrr7t-">'\0'</span></span></span> character, you could probably send anything you
want.
<!--l. 691--><p class="noindent" >The second route will take any XML that is wrapped in a <span class="obeylines-h"><span class="verb"><span 
class="pcrr7t-">&#x003C;test&#x003E;</span></span></span> tag and send that to your
handlers. That means you can send <span class="obeylines-h"><span class="verb"><span 
class="pcrr7t-">&#x003C;test</span><span 
class="pcrr7t-">&#x00A0;name="joe"&#x003E;&#x003C;age&#x003E;21&#x003C;/age&#x003E;&#x003C;/test&#x003E;</span></span></span>
and it will send it to <span 
class="pcrro7t-">xml</span><span 
class="pcrro7t-">_demo</span>.
<!--l. 695--><p class="noindent" >This is powerful because Mongrel2 now becomes a generic XML or JSON messaging
server very easily. For example, I wrote a simple little BBS demo with Mongrel2 and
wrote a very basic terminal client in Python for people to use instead of the browser.
Look at <span 
class="pcrb7t-">examples/bbs/client.py </span>to see how that works in full, but the meat of
it is:
                                                                  

                                                                  
<!--l. 701--><p class="noindent" ><a 
 id="x6-36001r10"></a><hr class="float"><div class="float" 
>
                                                                  

                                                                  
 <div class="caption" 
><span class="id">Source 10: </span><span  
class="content">                                                                              <span 
class="pplri7t-">BBS Client JSON Socket</span>
<span 
class="pplri7t-">Handling</span></span></div><!--tex4ht:label?: x6-36001r10 -->
<div class="fancyvrb" id="fancyvrb8"><a 
 id="x6-36003r1"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;CONN</span><span 
class="pcrr7t-x-x-90">&#x00A0;=</span><span 
class="pcrr7t-x-x-90">&#x00A0;socket.socket()</span><br class="fancyvrb" /><a 
 id="x6-36005r2"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;CONN.connect((host,</span><span 
class="pcrr7t-x-x-90">&#x00A0;port))</span><br class="fancyvrb" /><a 
 id="x6-36007r3"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br class="fancyvrb" /><a 
 id="x6-36009r4"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span id="textcolor23"><span 
class="pcrb7t-x-x-90">def</span></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span id="textcolor24"><span 
class="pcrb7t-x-x-90">read_msg</span></span><span 
class="pcrr7t-x-x-90">():</span>
<br class="fancyvrb" /><a 
 id="x6-36011r5"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;reply</span><span 
class="pcrr7t-x-x-90">&#x00A0;=</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="colorbox" id="colorbox25"><span id="textcolor26"><span 
class="pcrr7t-x-x-90">"</span></span></span><span 
class="colorbox" id="colorbox27"><span id="textcolor28"><span 
class="pcrr7t-x-x-90">"</span></span></span><br class="fancyvrb" /><a 
 id="x6-36013r6"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br class="fancyvrb" /><a 
 id="x6-36015r7"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;ch</span><span 
class="pcrr7t-x-x-90">&#x00A0;=</span><span 
class="pcrr7t-x-x-90">&#x00A0;CONN.recv(</span><span id="textcolor29"><span 
class="pcrb7t-x-x-90">1</span></span><span 
class="pcrr7t-x-x-90">)</span><br class="fancyvrb" /><a 
 id="x6-36017r8"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span id="textcolor30"><span 
class="pcrb7t-x-x-90">while</span></span><span 
class="pcrr7t-x-x-90">&#x00A0;ch</span><span 
class="pcrr7t-x-x-90">&#x00A0;!=</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="colorbox" id="colorbox31"><span id="textcolor32"><span 
class="pcrr7t-x-x-90">'</span></span></span><span 
class="colorbox" id="colorbox33"><span id="textcolor34"><span 
class="pcrr7t-x-x-90">\0</span></span></span><span 
class="colorbox" id="colorbox35"><span id="textcolor36"><span 
class="pcrr7t-x-x-90">'</span></span></span><span 
class="pcrr7t-x-x-90">:</span><br class="fancyvrb" /><a 
 id="x6-36019r9"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;reply</span><span 
class="pcrr7t-x-x-90">&#x00A0;+=</span><span 
class="pcrr7t-x-x-90">&#x00A0;ch</span>
<br class="fancyvrb" /><a 
 id="x6-36021r10"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;ch</span><span 
class="pcrr7t-x-x-90">&#x00A0;=</span><span 
class="pcrr7t-x-x-90">&#x00A0;CONN.recv(</span><span id="textcolor37"><span 
class="pcrb7t-x-x-90">1</span></span><span 
class="pcrr7t-x-x-90">)</span><br class="fancyvrb" /><a 
 id="x6-36023r11"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br class="fancyvrb" /><a 
 id="x6-36025r12"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span id="textcolor38"><span 
class="pcrb7t-x-x-90">return</span></span><span 
class="pcrr7t-x-x-90">&#x00A0;json.loads(b64decode(reply))</span>
<br class="fancyvrb" /><a 
 id="x6-36027r13"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br class="fancyvrb" /><a 
 id="x6-36029r14"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span id="textcolor39"><span 
class="pcrb7t-x-x-90">def</span></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span id="textcolor40"><span 
class="pcrb7t-x-x-90">post_msg</span></span><span 
class="pcrr7t-x-x-90">(data):</span><br class="fancyvrb" /><a 
 id="x6-36031r15"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;msg</span><span 
class="pcrr7t-x-x-90">&#x00A0;=</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="colorbox" id="colorbox41"><span id="textcolor42"><span 
class="pcrr7t-x-x-90">'</span></span></span><span 
class="colorbox" id="colorbox43"><span id="textcolor44"><span 
class="pcrr7t-x-x-90">@bbs</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span></span></span><span 
class="colorbox" id="colorbox45"><span id="textcolor46"><span 
class="pcrr7t-x-x-90">%s</span></span></span><span 
class="colorbox" id="colorbox47"><span id="textcolor48"><span 
class="pcrr7t-x-x-90">\x00</span></span></span><span 
class="colorbox" id="colorbox49"><span id="textcolor50"><span 
class="pcrr7t-x-x-90">'</span></span></span><span 
class="pcrr7t-x-x-90">&#x00A0;%</span><span 
class="pcrr7t-x-x-90">&#x00A0;(</span>
<br class="fancyvrb" /><a 
 id="x6-36033r16"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;json.dumps({</span><span 
class="colorbox" id="colorbox51"><span id="textcolor52"><span 
class="pcrr7t-x-x-90">'</span></span></span><span 
class="colorbox" id="colorbox53"><span id="textcolor54"><span 
class="pcrr7t-x-x-90">type</span></span></span><span 
class="colorbox" id="colorbox55"><span id="textcolor56"><span 
class="pcrr7t-x-x-90">'</span></span></span><span 
class="pcrr7t-x-x-90">:</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="colorbox" id="colorbox57"><span id="textcolor58"><span 
class="pcrr7t-x-x-90">'</span></span></span><span 
class="colorbox" id="colorbox59"><span id="textcolor60"><span 
class="pcrr7t-x-x-90">msg</span></span></span><span 
class="colorbox" id="colorbox61"><span id="textcolor62"><span 
class="pcrr7t-x-x-90">'</span></span></span><span 
class="pcrr7t-x-x-90">,</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="colorbox" id="colorbox63"><span id="textcolor64"><span 
class="pcrr7t-x-x-90">'</span></span></span><span 
class="colorbox" id="colorbox65"><span id="textcolor66"><span 
class="pcrr7t-x-x-90">msg</span></span></span><span 
class="colorbox" id="colorbox67"><span id="textcolor68"><span 
class="pcrr7t-x-x-90">'</span></span></span><span 
class="pcrr7t-x-x-90">:</span><span 
class="pcrr7t-x-x-90">&#x00A0;data}))</span><br class="fancyvrb" /><a 
 id="x6-36035r17"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;CONN.send(msg)</span></div>
                                                                  

                                                                  
</div><hr class="endfloat" />
<!--l. 724--><p class="noindent" >In that code, notice how (for historical reasons due to Flash sucking) the response is
base64 encoded, but your handler doesn&#8217;t have to do that. You can just adopt the
same protocol back. Other than that, the BBS example client is just opening a socket
and sending message, but Mongrel2 is converting them to messages to backend
handlers for processing.
<!--l. 730--><p class="noindent" >Finally, here&#8217;s the grammar rules in the parser for handling these messages:
                                                                  

                                                                  
<!--l. 732--><p class="noindent" ><a 
 id="x6-36036r11"></a><hr class="float"><div class="float" 
>
                                                                  

                                                                  
 <div class="caption" 
><span class="id">Source 11: </span><span  
class="content">                                                                                   <span 
class="pplri7t-">JSON/XML Message</span>
<span 
class="pplri7t-">Grammar</span></span></div><!--tex4ht:label?: x6-36036r11 -->
<div class="fancyvrb" id="fancyvrb9"><a 
 id="x6-36038r1"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;rel_path</span><span 
class="pcrr7t-x-x-90">&#x00A0;=</span><span 
class="pcrr7t-x-x-90">&#x00A0;(</span><span 
class="pcrr7t-x-x-90">&#x00A0;path</span><span 
class="colorbox" id="colorbox69"><span id="textcolor70"><span 
class="pcrr7t-x-x-90">?</span></span></span><span 
class="pcrr7t-x-x-90">&#x00A0;(</span><span 
class="colorbox" id="colorbox71"><span id="textcolor72"><span 
class="pcrr7t-x-x-90">"</span></span></span><span 
class="colorbox" id="colorbox73"><span id="textcolor74"><span 
class="pcrr7t-x-x-90">;</span></span></span><span 
class="colorbox" id="colorbox75"><span id="textcolor76"><span 
class="pcrr7t-x-x-90">"</span></span></span><span 
class="pcrr7t-x-x-90">&#x00A0;params)</span><span 
class="colorbox" id="colorbox77"><span id="textcolor78"><span 
class="pcrr7t-x-x-90">?</span></span></span><span 
class="pcrr7t-x-x-90">&#x00A0;)</span><span 
class="pcrr7t-x-x-90">&#x00A0;(</span><span 
class="colorbox" id="colorbox79"><span id="textcolor80"><span 
class="pcrr7t-x-x-90">"</span></span></span><span 
class="colorbox" id="colorbox81"><span id="textcolor82"><span 
class="pcrr7t-x-x-90">?</span></span></span><span 
class="colorbox" id="colorbox83"><span id="textcolor84"><span 
class="pcrr7t-x-x-90">"</span></span></span><span 
class="pcrr7t-x-x-90">&#x00A0;query)</span><span 
class="colorbox" id="colorbox85"><span id="textcolor86"><span 
class="pcrr7t-x-x-90">?</span></span></span><span 
class="pcrr7t-x-x-90">;</span>
<br class="fancyvrb" /><a 
 id="x6-36040r2"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;SocketJSONStart</span><span 
class="pcrr7t-x-x-90">&#x00A0;=</span><span 
class="pcrr7t-x-x-90">&#x00A0;(</span><span 
class="colorbox" id="colorbox87"><span id="textcolor88"><span 
class="pcrr7t-x-x-90">"</span></span></span><span 
class="colorbox" id="colorbox89"><span id="textcolor90"><span 
class="pcrr7t-x-x-90">@</span></span></span><span 
class="colorbox" id="colorbox91"><span id="textcolor92"><span 
class="pcrr7t-x-x-90">"</span></span></span><span 
class="pcrr7t-x-x-90">&#x00A0;rel_path);</span><br class="fancyvrb" /><a 
 id="x6-36042r3"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;SocketJSONData</span><span 
class="pcrr7t-x-x-90">&#x00A0;=</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="colorbox" id="colorbox93"><span id="textcolor94"><span 
class="pcrr7t-x-x-90">"</span></span></span><span 
class="colorbox" id="colorbox95"><span id="textcolor96"><span 
class="pcrr7t-x-x-90">{</span></span></span><span 
class="colorbox" id="colorbox97"><span id="textcolor98"><span 
class="pcrr7t-x-x-90">"</span></span></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span id="textcolor99"><span 
class="pcrr7t-x-x-90">any</span></span><span 
class="pcrr7t-x-x-90">&#x22C6;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="colorbox" id="colorbox100"><span id="textcolor101"><span 
class="pcrr7t-x-x-90">"</span></span></span><span 
class="colorbox" id="colorbox102"><span id="textcolor103"><span 
class="pcrr7t-x-x-90">}</span></span></span><span 
class="colorbox" id="colorbox104"><span id="textcolor105"><span 
class="pcrr7t-x-x-90">"</span></span></span><span 
class="pcrr7t-x-x-90">&#x00A0;:&#x003E;&#x003E;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="colorbox" id="colorbox106"><span id="textcolor107"><span 
class="pcrr7t-x-x-90">"</span></span></span><span 
class="colorbox" id="colorbox108"><span id="textcolor109"><span 
class="pcrr7t-x-x-90">\0</span></span></span><span 
class="colorbox" id="colorbox110"><span id="textcolor111"><span 
class="pcrr7t-x-x-90">"</span></span></span><span 
class="pcrr7t-x-x-90">;</span><br class="fancyvrb" /><a 
 id="x6-36044r4"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span>
<br class="fancyvrb" /><a 
 id="x6-36046r5"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;SocketXMLData</span><span 
class="pcrr7t-x-x-90">&#x00A0;=</span><span 
class="pcrr7t-x-x-90">&#x00A0;(</span><span 
class="colorbox" id="colorbox112"><span id="textcolor113"><span 
class="pcrr7t-x-x-90">"</span></span></span><span 
class="colorbox" id="colorbox114"><span id="textcolor115"><span 
class="pcrr7t-x-x-90">&#x003C;</span></span></span><span 
class="colorbox" id="colorbox116"><span id="textcolor117"><span 
class="pcrr7t-x-x-90">"</span></span></span><span 
class="pcrr7t-x-x-90">&#x00A0;[a-z0-</span><span id="textcolor118"><span 
class="pcrb7t-x-x-90">9</span></span><span 
class="pcrr7t-x-x-90">A-Z\-.]+)</span><br class="fancyvrb" /><a 
 id="x6-36048r6"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;(</span><span 
class="colorbox" id="colorbox119"><span id="textcolor120"><span 
class="pcrr7t-x-x-90">"</span></span></span><span 
class="colorbox" id="colorbox121"><span id="textcolor122"><span 
class="pcrr7t-x-x-90">/</span></span></span><span 
class="colorbox" id="colorbox123"><span id="textcolor124"><span 
class="pcrr7t-x-x-90">"</span></span></span><span 
class="pcrr7t-x-x-90">&#x00A0;|</span><span 
class="pcrr7t-x-x-90">&#x00A0;space</span><span 
class="pcrr7t-x-x-90">&#x00A0;|</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="colorbox" id="colorbox125"><span id="textcolor126"><span 
class="pcrr7t-x-x-90">"</span></span></span><span 
class="colorbox" id="colorbox127"><span id="textcolor128"><span 
class="pcrr7t-x-x-90">&#x003E;</span></span></span><span 
class="colorbox" id="colorbox129"><span id="textcolor130"><span 
class="pcrr7t-x-x-90">"</span></span></span><span 
class="pcrr7t-x-x-90">)</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span id="textcolor131"><span 
class="pcrr7t-x-x-90">any</span></span><span 
class="pcrr7t-x-x-90">&#x22C6;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="colorbox" id="colorbox132"><span id="textcolor133"><span 
class="pcrr7t-x-x-90">"</span></span></span><span 
class="colorbox" id="colorbox134"><span id="textcolor135"><span 
class="pcrr7t-x-x-90">&#x003E;</span></span></span><span 
class="colorbox" id="colorbox136"><span id="textcolor137"><span 
class="pcrr7t-x-x-90">"</span></span></span><span 
class="pcrr7t-x-x-90">&#x00A0;:&#x003E;&#x003E;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="colorbox" id="colorbox138"><span id="textcolor139"><span 
class="pcrr7t-x-x-90">"</span></span></span><span 
class="colorbox" id="colorbox140"><span id="textcolor141"><span 
class="pcrr7t-x-x-90">\0</span></span></span><span 
class="colorbox" id="colorbox142"><span id="textcolor143"><span 
class="pcrr7t-x-x-90">"</span></span></span><span 
class="pcrr7t-x-x-90">;</span>
<br class="fancyvrb" /><a 
 id="x6-36050r7"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br class="fancyvrb" /><a 
 id="x6-36052r8"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;SocketJSON</span><span 
class="pcrr7t-x-x-90">&#x00A0;=</span><span 
class="pcrr7t-x-x-90">&#x00A0;SocketJSONStart</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="colorbox" id="colorbox144"><span id="textcolor145"><span 
class="pcrr7t-x-x-90">"</span></span></span><span 
class="colorbox" id="colorbox146"><span id="textcolor147"><span 
class="pcrr7t-x-x-90">&#x00A0;</span></span></span><span 
class="colorbox" id="colorbox148"><span id="textcolor149"><span 
class="pcrr7t-x-x-90">"</span></span></span><span 
class="pcrr7t-x-x-90">&#x00A0;SocketJSONData;</span>
<br class="fancyvrb" /><a 
 id="x6-36054r9"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;SocketXML</span><span 
class="pcrr7t-x-x-90">&#x00A0;=</span><span 
class="pcrr7t-x-x-90">&#x00A0;SocketXMLData;</span><br class="fancyvrb" /><a 
 id="x6-36056r10"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br class="fancyvrb" /><a 
 id="x6-36058r11"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;SocketRequest</span><span 
class="pcrr7t-x-x-90">&#x00A0;=</span><span 
class="pcrr7t-x-x-90">&#x00A0;(SocketXML</span><span 
class="pcrr7t-x-x-90">&#x00A0;|</span><span 
class="pcrr7t-x-x-90">&#x00A0;SocketJSON);</span></div>
                                                                  

                                                                  
</div><hr class="endfloat" />
<!--l. 749--><p class="noindent" >If you read that carefully, you&#8217;ll see you can actually pass query strings and path
parameters to your JSON socket handlers. That&#8217;s currently not used, but in the
future we might.
<!--l. 753--><p class="noindent" >One caveat to this whole feature is these targets can only be routed to the
<span 
class="pcrro7t-">Server.default</span><span 
class="pcrro7t-">_host </span>of the server. There&#8217;s not enough information in these
routes to determine a target host (like the <span 
class="pcrro7t-">Host: </span>header in HTTP) so you can only
send it to the default target host.
<h3 class="sectionHead"><span class="titlemark">3.7    </span> <a 
 id="x6-370003.7"></a>Deployment Logs And Commits</h3>
<!--l. 760--><p class="noindent" >A very nice feature for people doing operations work is that m2sh keeps track of all
the commands you run on it while you work, and lets you add little commit logs to
the log for documentation later. These commit logs are then maintained even across
<span 
class="pcrro7t-">m2sh load </span>commands so you can see what&#8217;s going on. They track who did
something, what server they did it on, what time they did it and what they
did.
<!--l. 767--><p class="noindent" >To see the logs for your own tests, just do <span 
class="pcrro7t-">m2sh log -db simple.sqlite </span>and
then, if you want to add a commit log message, you use the <span 
class="pcrro7t-">m2sh commit</span>
command. Here&#8217;s an example from mongrel2.org:
                                                                  

                                                                  
<!--l. 771--><p class="noindent" ><a 
 id="x6-37001r12"></a><hr class="float"><div class="float" 
>
                                                                  

                                                                  
 <div class="caption" 
><span class="id">Source 12: </span><span  
class="content">                                                                                          <span 
class="pplri7t-">Example Commit</span>
<span 
class="pplri7t-">Log</span></span></div><!--tex4ht:label?: x6-37001r12 -->
<!--l. 772-->
<div class="lstlisting" id="listing-3"><span class="label"><a 
 id="x6-37002r1"></a></span><span 
class="pcrr7t-x-x-90">&#x003E;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">m2sh</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">log</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-37003r2"></a></span><span 
class="pcrr7t-x-x-90">[2010-07-18</span><span 
class="pcrr7t-x-x-90">T04</span><span 
class="pcrr7t-x-x-90">:14:53,</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">mongrel2@zedshaw</span><span 
class="pcrr7t-x-x-90">,</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">init_command</span><span 
class="pcrr7t-x-x-90">]</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">/</span><span 
class="pcrr7t-x-x-90">usr</span><span 
class="pcrr7t-x-x-90">/</span><span 
class="pcrr7t-x-x-90">bin</span><span 
class="pcrr7t-x-x-90">/</span><span 
class="pcrr7t-x-x-90">m2sh</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">init</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-37004r3"></a></span><span 
class="pcrr7t-x-x-90">[2010-07-18</span><span 
class="pcrr7t-x-x-90">T04</span><span 
class="pcrr7t-x-x-90">:15:06,</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">mongrel2@zedshaw</span><span 
class="pcrr7t-x-x-90">,</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">load_command</span><span 
class="pcrr7t-x-x-90">]</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">/</span><span 
class="pcrr7t-x-x-90">usr</span><span 
class="pcrr7t-x-x-90">/</span><span 
class="pcrr7t-x-x-90">bin</span><span 
class="pcrr7t-x-x-90">/</span><span 
class="pcrr7t-x-x-90">m2sh</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">load</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-37005r4"></a></span><span 
class="pcrr7t-x-x-90">[2010-07-18</span><span 
class="pcrr7t-x-x-90">T04</span><span 
class="pcrr7t-x-x-90">:22:06,</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">mongrel2@zedshaw</span><span 
class="pcrr7t-x-x-90">,</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">load_command</span><span 
class="pcrr7t-x-x-90">]</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">/</span><span 
class="pcrr7t-x-x-90">usr</span><span 
class="pcrr7t-x-x-90">/</span><span 
class="pcrr7t-x-x-90">bin</span><span 
class="pcrr7t-x-x-90">/</span><span 
class="pcrr7t-x-x-90">m2sh</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">load</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-37006r5"></a></span><span 
class="pcrr7t-x-x-90">[2010-07-18</span><span 
class="pcrr7t-x-x-90">T04</span><span 
class="pcrr7t-x-x-90">:23:32,</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">mongrel2@zedshaw</span><span 
class="pcrr7t-x-x-90">,</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">load_command</span><span 
class="pcrr7t-x-x-90">]</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">/</span><span 
class="pcrr7t-x-x-90">usr</span><span 
class="pcrr7t-x-x-90">/</span><span 
class="pcrr7t-x-x-90">bin</span><span 
class="pcrr7t-x-x-90">/</span><span 
class="pcrr7t-x-x-90">m2sh</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">load</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-37007r6"></a></span><span 
class="pcrr7t-x-x-90">[2010-07-18</span><span 
class="pcrr7t-x-x-90">T04</span><span 
class="pcrr7t-x-x-90">:26:16,</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">mongrel2@zedshaw</span><span 
class="pcrr7t-x-x-90">,</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">upgrade</span><span 
class="pcrr7t-x-x-90">]</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">Latest</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">code</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">for</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">Mongrel2</span><span 
class="pcrr7t-x-x-90">.</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-37008r7"></a></span><span 
class="pcrr7t-x-x-90">[2010-07-18</span><span 
class="pcrr7t-x-x-90">T18</span><span 
class="pcrr7t-x-x-90">:05:59,</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">mongrel2@zedshaw</span><span 
class="pcrr7t-x-x-90">,</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">load_command</span><span 
class="pcrr7t-x-x-90">]</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">/</span><span 
class="pcrr7t-x-x-90">usr</span><span 
class="pcrr7t-x-x-90">/</span><span 
class="pcrr7t-x-x-90">bin</span><span 
class="pcrr7t-x-x-90">/</span><span 
class="pcrr7t-x-x-90">m2sh</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">load</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-37009r8"></a></span><span 
class="pcrr7t-x-x-90">[2010-07-18</span><span 
class="pcrr7t-x-x-90">T20</span><span 
class="pcrr7t-x-x-90">:09:01,</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">mongrel2@zedshaw</span><span 
class="pcrr7t-x-x-90">,</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">init_command</span><span 
class="pcrr7t-x-x-90">]</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">/</span><span 
class="pcrr7t-x-x-90">usr</span><span 
class="pcrr7t-x-x-90">/</span><span 
class="pcrr7t-x-x-90">bin</span><span 
class="pcrr7t-x-x-90">/</span><span 
class="pcrr7t-x-x-90">m2sh</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">config</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-37010r9"></a></span><span 
class="pcrr7t-x-x-90">[2010-07-18</span><span 
class="pcrr7t-x-x-90">T20</span><span 
class="pcrr7t-x-x-90">:09:02,</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">mongrel2@zedshaw</span><span 
class="pcrr7t-x-x-90">,</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">load_command</span><span 
class="pcrr7t-x-x-90">]</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">/</span><span 
class="pcrr7t-x-x-90">usr</span><span 
class="pcrr7t-x-x-90">/</span><span 
class="pcrr7t-x-x-90">bin</span><span 
class="pcrr7t-x-x-90">/</span><span 
class="pcrr7t-x-x-90">m2sh</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">config</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-37011r10"></a></span><span 
class="pcrr7t-x-x-90">&#x003E;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">m2sh</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">commit</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">-</span><span 
class="pcrr7t-x-x-90">what</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">mongrel2</span><span 
class="pcrr7t-x-x-90">.</span><span 
class="pcrr7t-x-x-90">org</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">-</span><span 
class="pcrr7t-x-x-90">why</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">"</span><span 
class="pcrr7t-x-x-90">Testing</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">things</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">out</span><span 
class="pcrr7t-x-x-90">."</span>
</div>
                                                                  

                                                                  
</div><hr class="endfloat" />
<!--l. 786--><p class="noindent" >The motivation for this feature is the trend that ops stores server configurations in
revision control systems like git or etckeeper. This works great for holding the
configuration files, but it doesn&#8217;t tell you what happened on each server. In many
cases, the configuration files also need to be reworked or altered for each
deployment. With the m2sh log and commit system, you can augment your revision
control with deployment action tracking.
<!--l. 792--><p class="noindent" >Later versions of Mongrel2 will keep small amounts of statistics which will link
these actions to changes in Mongrel2 behavior like frequent crashing, failures,
slowness, or other problems.
<!--l. 795--><p class="noindent" >Basically, there&#8217;s nowhere to hide. Mongrel2 will help operations figure out who
needs to get fired the next time Twitter goes down.
<h3 class="sectionHead"><span class="titlemark">3.8    </span> <a 
 id="x6-380003.8"></a>Control Port</h3>
<!--l. 801--><p class="noindent" >Just before the release of 1.0, we added a feature called the &#8220;Control Port&#8221;, which lets
you connect to a running Mongrel2 server over a unix (domain) socket and give it
control commands. These commands let you get the status of running tasks, lists of
currently connected sockets and how long they&#8217;ve been connected, the server&#8217;s
current time and kill a connection. Using this control port, you can then
implement any monitoring and timeout policies you want, and provide better
status.
<!--l. 809--><p class="noindent" >By default, the control port is in your chroot at run/control, but you can set
the <span 
class="pcrro7t-">control</span><span 
class="pcrro7t-">_port </span>setting to change this. You can actually change it to
any ZeroMQ valid spec you want, although you&#8217;re advised to use IPC for
security.
<!--l. 813--><p class="noindent" >Once Mongrel2 starts, you can then use <span 
class="pcrb7t-">m2sh </span>to connect to Mongrel2 and control
it using the simple command language. Currently, what you get back is
very raw, but it will improve as we work on the control port and what it
does.
<!--l. 817--><p class="noindent" >The list of commands you can issue are:
     <dl class="description"><dt class="description">
<span 
class="pplb7t-">stop</span> </dt><dd 
class="description">Stops the server using a SIGINT.
     </dd><dt class="description">
<span 
class="pplb7t-">reload</span> </dt><dd 
class="description">Reloads the server using a SIGHUP.
     </dd><dt class="description">
                                                                  

                                                                  
<span 
class="pplb7t-">terminate</span> </dt><dd 
class="description">Terminates the server with SIGTERM.
     </dd><dt class="description">
<span 
class="pplb7t-">help</span> </dt><dd 
class="description">Prints out a simple help message.
     </dd><dt class="description">
<span 
class="pplb7t-">uuid</span> </dt><dd 
class="description">Gives you the server&#8217;s UUID.
     </dd><dt class="description">
<span 
class="pplb7t-">info</span> </dt><dd 
class="description">More information about the server.
     </dd><dt class="description">
<span 
class="pplb7t-">status what=tasks</span> </dt><dd 
class="description">Dumps a JSON formatted dict (object) of all the currently
     running  tasks  and  what  they&#8217;re  doing.  Think  of  it  like  an  internal  <span 
class="pcrb7t-">ps</span>
     command.
     </dd><dt class="description">
<span 
class="pplb7t-">status what=net</span> </dt><dd 
class="description">Dumps a JSON dict that matches connections IDs (same ones
     your handlers get) to the seconds since their last ping. In the case of an
     HTTP connection this is how long they&#8217;ve been connected. In the case of
     a JSON socket this is the last time a ping message was received.
     </dd><dt class="description">
<span 
class="pplb7t-">time</span> </dt><dd 
class="description">Prints the unix time the server thinks it&#8217;s using. Useful for synching.
     </dd><dt class="description">
<span 
class="pplb7t-">kill id=ID</span> </dt><dd 
class="description">Does a forced close on the socket that is at this ID from the <span 
class="pcrro7t-">status</span>
     <span 
class="pcrro7t-">net </span>command. This is a rather violent way to kill a connection so don&#8217;t
     do it that often, but if you&#8217;re overloaded then this is where to go.
     </dd><dt class="description">
<span 
class="pplb7t-">control</span><span 
class="pplb7t-">_stop</span> </dt><dd 
class="description">Shuts down the control port permanently in case you want to
     keep it from being accessed for some reason.</dd></dl>
<!--l. 841--><p class="noindent" >You then use the control port by running <span 
class="pcrro7t-">m2sh</span>:
<!--l. 843--><p class="noindent" >
<div class="fancyvrb" id="fancyvrb10"><a 
 id="x6-38002r1"></a><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;m2sh</span><span 
class="pcrr7t-">&#x00A0;control</span><span 
class="pcrr7t-">&#x00A0;-every</span><br class="fancyvrb" /><a 
 id="x6-38004r2"></a><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><br class="fancyvrb" /><a 
 id="x6-38006r3"></a><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;m2</span><span 
class="pcrr7t-">&#x00A0;[</span><span id="textcolor150"><span 
class="pcrr7t-">test</span></span><span 
class="pcrr7t-">]&#x003E;</span><span 
class="pcrr7t-">&#x00A0;</span><span id="textcolor151"><span 
class="pcrr7t-">help</span></span><br class="fancyvrb" /><a 
 id="x6-38008r4"></a><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;name</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span id="textcolor152"><span 
class="pcrr7t-">help</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span></span>
<br class="fancyvrb" /><a 
 id="x6-38010r5"></a><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;stop</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;stop</span><span 
class="pcrr7t-">&#x00A0;the</span><span 
class="pcrr7t-">&#x00A0;server</span><span 
class="pcrr7t-">&#x00A0;(SIGINT)</span><br class="fancyvrb" /><a 
 id="x6-38012r6"></a><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;reload</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;reload</span><span 
class="pcrr7t-">&#x00A0;the</span><span 
class="pcrr7t-">&#x00A0;server</span>
<br class="fancyvrb" /><a 
 id="x6-38014r7"></a><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span id="textcolor153"><span 
class="pcrr7t-">help</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span></span><span 
class="pcrr7t-">this</span><span 
class="pcrr7t-">&#x00A0;</span><span id="textcolor154"><span 
class="pcrr7t-">command</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span></span><br class="fancyvrb" /><a 
 id="x6-38016r8"></a><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;control_stop</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;stop</span><span 
class="pcrr7t-">&#x00A0;control</span><span 
class="pcrr7t-">&#x00A0;port</span>
<br class="fancyvrb" /><a 
 id="x6-38018r9"></a><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span id="textcolor155"><span 
class="pcrr7t-">kill</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span></span><span id="textcolor156"><span 
class="pcrr7t-">kill</span><span 
class="pcrr7t-">&#x00A0;</span></span><span 
class="pcrr7t-">a</span><span 
class="pcrr7t-">&#x00A0;connection</span><br class="fancyvrb" /><a 
 id="x6-38020r10"></a><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;status</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;status,</span><span 
class="pcrr7t-">&#x00A0;</span><span id="textcolor157"><span 
class="pcrr7t-">what</span></span><span 
class="pcrr7t-">=[</span><span 
class="colorbox" id="colorbox158"><span id="textcolor159"><span 
class="pcrr7t-">'net'</span></span></span><span 
class="pcrr7t-">|</span><span 
class="colorbox" id="colorbox160"><span id="textcolor161"><span 
class="pcrr7t-">'tasks'</span></span></span><span 
class="pcrr7t-">]</span>
<br class="fancyvrb" /><a 
 id="x6-38022r11"></a><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;terminate</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;terminate</span><span 
class="pcrr7t-">&#x00A0;the</span><span 
class="pcrr7t-">&#x00A0;server</span><span 
class="pcrr7t-">&#x00A0;(SIGTERM)</span><br class="fancyvrb" /><a 
 id="x6-38024r12"></a><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span id="textcolor162"><span 
class="pcrr7t-">time</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span></span><span 
class="pcrr7t-">the</span><span 
class="pcrr7t-">&#x00A0;server</span><span 
class="colorbox" id="colorbox163"><span id="textcolor164"><span 
class="pcrr7t-">'s</span><span 
class="pcrr7t-">&#x00A0;time</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span></span></span>
<br class="fancyvrb" /><a 
 id="x6-38026r13"></a><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="colorbox" id="colorbox165"><span id="textcolor166"><span 
class="pcrr7t-">uuid</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;the</span><span 
class="pcrr7t-">&#x00A0;server'</span></span></span><span 
class="pcrr7t-">s</span><span 
class="pcrr7t-">&#x00A0;uuid</span><br class="fancyvrb" /><a 
 id="x6-38028r14"></a><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;info</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;information</span><span 
class="pcrr7t-">&#x00A0;about</span><span 
class="pcrr7t-">&#x00A0;this</span><span 
class="pcrr7t-">&#x00A0;server</span>
<br class="fancyvrb" /><a 
 id="x6-38030r15"></a><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><br class="fancyvrb" /><a 
 id="x6-38032r16"></a><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;m2</span><span 
class="pcrr7t-">&#x00A0;[</span><span id="textcolor167"><span 
class="pcrr7t-">test</span></span><span 
class="pcrr7t-">]&#x003E;</span><span 
class="pcrr7t-">&#x00A0;info</span><br class="fancyvrb" /><a 
 id="x6-38034r17"></a><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;port:</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;6767</span><br class="fancyvrb" /><a 
 id="x6-38036r18"></a><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;bind_addr:</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;0.0.0.0</span>
<br class="fancyvrb" /><a 
 id="x6-38038r19"></a><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;uuid:</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;f400bf85-4538-4f7a-8908-67e313d515c2</span><br class="fancyvrb" /><a 
 id="x6-38040r20"></a><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;chroot:</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;./</span>
<br class="fancyvrb" /><a 
 id="x6-38042r21"></a><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;access_log:</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;.//logs/access.log</span><br class="fancyvrb" /><a 
 id="x6-38044r22"></a><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;error_log:</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;/logs/error.log</span>
<br class="fancyvrb" /><a 
 id="x6-38046r23"></a><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;pid_file:</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;./run/mongrel2.pid</span><br class="fancyvrb" /><a 
 id="x6-38048r24"></a><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;default_hostname:</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;localhost</span><br class="fancyvrb" /><a 
 id="x6-38050r25"></a><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><br class="fancyvrb" /><a 
 id="x6-38052r26"></a><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;m2</span><span 
class="pcrr7t-">&#x00A0;[</span><span id="textcolor168"><span 
class="pcrr7t-">test</span></span><span 
class="pcrr7t-">]&#x003E;</span></div>
<!--l. 873--><p class="noindent" >The protocol to and from the control socket is a simple tnetstring in and out that any
                                                                  

                                                                  
langauge can read. Here&#8217;s a nearly complete Python client that is using the control
port:
                                                                  

                                                                  
<!--l. 877--><p class="noindent" ><a 
 id="x6-38053r13"></a><hr class="float"><div class="float" 
>
                                                                  

                                                                  
 <div class="caption" 
><span class="id">Source 13: </span><span  
class="content">                                                                                     <span 
class="pplri7t-">Python Control Port</span>
<span 
class="pplri7t-">Example</span></span></div><!--tex4ht:label?: x6-38053r13 -->
<div class="fancyvrb" id="fancyvrb11"><a 
 id="x6-38055r1"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span id="textcolor169"><span 
class="pcrb7t-x-x-90">import</span></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span id="textcolor170"><span 
class="pcrb7t-x-x-90">zmq</span></span><br class="fancyvrb" /><a 
 id="x6-38057r2"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span id="textcolor171"><span 
class="pcrb7t-x-x-90">from</span></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span id="textcolor172"><span 
class="pcrb7t-x-x-90">mongrel2</span></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span id="textcolor173"><span 
class="pcrb7t-x-x-90">import</span></span><span 
class="pcrr7t-x-x-90">&#x00A0;tnetstrings</span><br class="fancyvrb" /><a 
 id="x6-38059r3"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span id="textcolor174"><span 
class="pcrb7t-x-x-90">from</span></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span id="textcolor175"><span 
class="pcrb7t-x-x-90">pprint</span></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span id="textcolor176"><span 
class="pcrb7t-x-x-90">import</span></span><span 
class="pcrr7t-x-x-90">&#x00A0;pprint</span><br class="fancyvrb" /><a 
 id="x6-38061r4"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span>
<br class="fancyvrb" /><a 
 id="x6-38063r5"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;CTX</span><span 
class="pcrr7t-x-x-90">&#x00A0;=</span><span 
class="pcrr7t-x-x-90">&#x00A0;zmq.Context()</span><br class="fancyvrb" /><a 
 id="x6-38065r6"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br class="fancyvrb" /><a 
 id="x6-38067r7"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;addr</span><span 
class="pcrr7t-x-x-90">&#x00A0;=</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="colorbox" id="colorbox177"><span id="textcolor178"><span 
class="pcrr7t-x-x-90">"</span></span></span><span 
class="colorbox" id="colorbox179"><span id="textcolor180"><span 
class="pcrr7t-x-x-90">ipc://run/control</span></span></span><span 
class="colorbox" id="colorbox181"><span id="textcolor182"><span 
class="pcrr7t-x-x-90">"</span></span></span><br class="fancyvrb" /><a 
 id="x6-38069r8"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br class="fancyvrb" /><a 
 id="x6-38071r9"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;ctl</span><span 
class="pcrr7t-x-x-90">&#x00A0;=</span><span 
class="pcrr7t-x-x-90">&#x00A0;CTX.socket(zmq.REQ)</span><br class="fancyvrb" /><a 
 id="x6-38073r10"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span>
<br class="fancyvrb" /><a 
 id="x6-38075r11"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span id="textcolor183"><span 
class="pcrb7t-x-x-90">print</span></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="colorbox" id="colorbox184"><span id="textcolor185"><span 
class="pcrr7t-x-x-90">"</span></span></span><span 
class="colorbox" id="colorbox186"><span id="textcolor187"><span 
class="pcrr7t-x-x-90">CONNECTING</span></span></span><span 
class="colorbox" id="colorbox188"><span id="textcolor189"><span 
class="pcrr7t-x-x-90">"</span></span></span><br class="fancyvrb" /><a 
 id="x6-38077r12"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;ctl.connect(addr)</span><br class="fancyvrb" /><a 
 id="x6-38079r13"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br class="fancyvrb" /><a 
 id="x6-38081r14"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span id="textcolor190"><span 
class="pcrb7t-x-x-90">while</span></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span id="textcolor191"><span 
class="pcrr7t-x-x-90">True</span></span><span 
class="pcrr7t-x-x-90">:</span><br class="fancyvrb" /><a 
 id="x6-38083r15"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;cmd</span><span 
class="pcrr7t-x-x-90">&#x00A0;=</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span id="textcolor192"><span 
class="pcrr7t-x-x-90">raw_input</span></span><span 
class="pcrr7t-x-x-90">(</span><span 
class="colorbox" id="colorbox193"><span id="textcolor194"><span 
class="pcrr7t-x-x-90">"</span></span></span><span 
class="colorbox" id="colorbox195"><span id="textcolor196"><span 
class="pcrr7t-x-x-90">&#x003E;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span></span></span><span 
class="colorbox" id="colorbox197"><span id="textcolor198"><span 
class="pcrr7t-x-x-90">"</span></span></span><span 
class="pcrr7t-x-x-90">)</span>
<br class="fancyvrb" /><a 
 id="x6-38085r16"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span id="textcolor199"><span 
class="pcrr7t-x-x-90">#</span><span 
class="pcrr7t-x-x-90">&#x00A0;will</span><span 
class="pcrr7t-x-x-90">&#x00A0;only</span><span 
class="pcrr7t-x-x-90">&#x00A0;work</span><span 
class="pcrr7t-x-x-90">&#x00A0;with</span><span 
class="pcrr7t-x-x-90">&#x00A0;simple</span><span 
class="pcrr7t-x-x-90">&#x00A0;commands</span><span 
class="pcrr7t-x-x-90">&#x00A0;that</span><span 
class="pcrr7t-x-x-90">&#x00A0;have</span><span 
class="pcrr7t-x-x-90">&#x00A0;no</span><span 
class="pcrr7t-x-x-90">&#x00A0;arguments</span></span>
<br class="fancyvrb" /><a 
 id="x6-38087r17"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;ctl.send(tnetstrings.dump([cmd,</span><span 
class="pcrr7t-x-x-90">&#x00A0;{}]))</span><br class="fancyvrb" /><a 
 id="x6-38089r18"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br class="fancyvrb" /><a 
 id="x6-38091r19"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;resp</span><span 
class="pcrr7t-x-x-90">&#x00A0;=</span><span 
class="pcrr7t-x-x-90">&#x00A0;ctl.recv()</span>
<br class="fancyvrb" /><a 
 id="x6-38093r20"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br class="fancyvrb" /><a 
 id="x6-38095r21"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;pprint(tnetstrings.parse(resp))</span><br class="fancyvrb" /><a 
 id="x6-38097r22"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br class="fancyvrb" /><a 
 id="x6-38099r23"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;ctl.close()</span></div>
                                                                  

                                                                  
</div><hr class="endfloat" />
<!--l. 906--><p class="noindent" >You obviously don&#8217;t need to do this, but should you want to do something special
like a management interface, this is your start.
<h3 class="sectionHead"><span class="titlemark">3.9    </span> <a 
 id="x6-390003.9"></a>Multiple Servers</h3>
<!--l. 912--><p class="noindent" >A Mongrel2 process itself does not have any support for running multiple servers;
instead, it takes two simple parameters: a sqlite config database and a server uuid
that names the server to be launched. This is done to keep the mongrel2 code simple
and workable.
<!--l. 917--><p class="noindent" >However.
<!--l. 919--><p class="noindent" >Mongrel2&#8217;s m2sh does support launching multiple servers from a single
configuration database. By passing -every to many m2sh commands, you
are able to perform actions on all configured servers at once. You can also
perform actions on single servers by specifying their uuid, name or host. If any
parameter given is ambiguous (that is if, for example, you search with <span 
class="pcrro7t-">-host</span>
<span 
class="pcrro7t-">localhost </span>and your config contains two servers which attempt to bind to
localhost), m2sh will list the matching servers and ask you to clarify your
selection.
<!--l. 927--><p class="noindent" >For example: <!--l. 928-->
<div class="lstlisting" id="listing-4"><span class="label"><a 
 id="x6-39001r1"></a></span><span 
class="pcrr7t-">&#x003E;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">m2sh</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">start</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">-</span><span 
class="pcrr7t-">db</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">config</span><span 
class="pcrr7t-">.</span><span 
class="pcrr7t-">sqlite</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">-</span><span 
class="pcrr7t-">every</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x6-39002r2"></a></span><span 
class="pcrr7t-">Launching</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">server</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">localhost</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">XXX</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">on</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">port</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">6768</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x6-39003r3"></a></span><span 
class="pcrr7t-">...</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x6-39004r4"></a></span><span 
class="pcrr7t-">Launching</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">server</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">localhost</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">XXX</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">on</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">port</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">6767</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x6-39005r5"></a></span><span 
class="pcrr7t-">...</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x6-39006r6"></a></span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x6-39007r7"></a></span><span 
class="pcrr7t-">&#x003E;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">m2sh</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">start</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">-</span><span 
class="pcrr7t-">db</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">config</span><span 
class="pcrr7t-">.</span><span 
class="pcrr7t-">sqlite</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">-</span><span 
class="pcrr7t-">host</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">localhost</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x6-39008r8"></a></span><span 
class="pcrr7t-">Not</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">sure</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">which</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">server</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">to</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">run</span><span 
class="pcrr7t-">,</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">what</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">I</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">found</span><span 
class="pcrr7t-">:</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x6-39009r9"></a></span><span 
class="pcrr7t-">NAME</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">HOST</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">UUID</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x6-39010r10"></a></span><span 
class="pcrr7t-">--------------</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x6-39011r11"></a></span><span 
class="pcrr7t-">localhost</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">localhost</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">XXX</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x6-39012r12"></a></span><span 
class="pcrr7t-">localhost</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">localhost</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">XXX</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x6-39013r13"></a></span><span 
class="pcrr7t-">&#x22C6;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">Use</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">-</span><span 
class="pcrr7t-">every</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">to</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">run</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">them</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">all</span><span 
class="pcrr7t-">.</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x6-39014r14"></a></span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x6-39015r15"></a></span><span 
class="pcrr7t-">&#x003E;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">m2sh</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">start</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">-</span><span 
class="pcrr7t-">db</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">config</span><span 
class="pcrr7t-">.</span><span 
class="pcrr7t-">sqlite</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">-</span><span 
class="pcrr7t-">uuid</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">XXX</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x6-39016r16"></a></span><span 
class="pcrr7t-">Launching</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">server</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">localhost</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">XXX</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">on</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">port</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">6767</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x6-39017r17"></a></span><span 
class="pcrr7t-">...</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x6-39018r18"></a></span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x6-39019r19"></a></span><span 
class="pcrr7t-">&#x003E;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">m2sh</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">running</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">-</span><span 
class="pcrr7t-">db</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">config</span><span 
class="pcrr7t-">.</span><span 
class="pcrr7t-">sqlite</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">-</span><span 
class="pcrr7t-">every</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x6-39020r20"></a></span><span 
class="pcrr7t-">Found</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">server</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">localhost</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">XXX</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">RUNNING</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">at</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">PID</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">28525</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x6-39021r21"></a></span><span 
class="pcrr7t-">PID</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">file</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">run</span><span 
class="pcrr7t-">/</span><span 
class="pcrr7t-">mongrel2</span><span 
class="pcrr7t-">.</span><span 
class="pcrr7t-">pid</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">not</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">found</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">for</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">server</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">localhost</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">XXX</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x6-39022r22"></a></span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x6-39023r23"></a></span><span 
class="pcrr7t-">&#x003E;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">m2sh</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">stop</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">-</span><span 
class="pcrr7t-">db</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">config</span><span 
class="pcrr7t-">.</span><span 
class="pcrr7t-">sqlite</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">-</span><span 
class="pcrr7t-">every</span>
</div>
<!--l. 956--><p class="noindent" >
<h3 class="sectionHead"><span class="titlemark">3.10    </span> <a 
 id="x6-400003.10"></a>Tweakable Expert Settings</h3>
<!--l. 958--><p class="noindent" >Many of Mongrel2&#8217;s internal settings are configurable using the settings system.
Some of these are dangerous to mess with, so make sure you test any changes before
you try to run them. Setting them to 0 or negative numbers isn&#8217;t checked, so if you
make a setting and things go crazy, you need to not make that setting. All of these
have good defaults so you can leave them alone unless you need to change
them.
<!--l. 965--><p class="noindent" >To configure your settings, you set the variable <span 
class="pcrro7t-">settings </span>and you&#8217;re done:
                                                                  

                                                                  
<!--l. 967--><p class="noindent" ><a 
 id="x6-40001r14"></a><hr class="float"><div class="float" 
>
                                                                  

                                                                  
 <div class="caption" 
><span class="id">Source 14: </span><span  
class="content">                                                                                                      <span 
class="pplri7t-">Changing</span>
<span 
class="pplri7t-">Settings</span></span></div><!--tex4ht:label?: x6-40001r14 -->
<!--l. 968-->
<div class="lstlisting" id="listing-5"><span class="label"><a 
 id="x6-40002r1"></a></span><span 
class="pcrr7t-x-x-90">settings</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">=</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">{"</span><span 
class="pcrr7t-x-x-90">zeromq</span><span 
class="pcrr7t-x-x-90">.</span><span 
class="pcrr7t-x-x-90">threads</span><span 
class="pcrr7t-x-x-90">":</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">1,</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">"</span><span 
class="pcrr7t-x-x-90">limits</span><span 
class="pcrr7t-x-x-90">.</span><span 
class="pcrr7t-x-x-90">url_path</span><span 
class="pcrr7t-x-x-90">":</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">1024}</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-40003r2"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-40004r3"></a></span><span 
class="pcrr7t-x-x-90">servers</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">=</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">[</span><span 
class="pcrr7t-x-x-90">main</span><span 
class="pcrr7t-x-x-90">]</span>
</div>
                                                                  

                                                                  
</div><hr class="endfloat" />
<!--l. 976--><p class="noindent" >Mongrel2 will read these on the fly and write INFO log messages telling you what
the settings are so you can debug them if they cause problems. The list of available
settings are:
     <dl class="description"><dt class="description">
<span 
class="pplb7t-">control</span><span 
class="pplb7t-">_port=ipc://run/control</span> </dt><dd 
class="description">This is where Mongrel2 will listen with 0MQ
     for control messages. You should use <span class="obeylines-h"><span class="verb"><span 
class="pcrr7t-">ipc://</span></span></span> for the spec, so that only a
     local user with file access can get at it.
     </dd><dt class="description">
<span 
class="pplb7t-">disable.access</span><span 
class="pplb7t-">_logging=0</span> </dt><dd 
class="description">Set this to <span class="obeylines-h"><span class="verb"><span 
class="pcrr7t-">1</span></span></span> to turn off access logs. You still have to
     specify log files but they won&#8217;t be created.
     </dd><dt class="description">
<span 
class="pplb7t-">limits.buffer</span><span 
class="pplb7t-">_size=2 * 1024</span> </dt><dd 
class="description">Internal IO buffers, used for things like proxying
     and handling requests. This is a <span 
class="pplri7t-">very </span>conservative setting, so if you get
     HTTP headers greater than this, you&#8217;ll want to increase this setting. You&#8217;ll
     also want to shoot whoever is sending you those requests, because the
     average is 400-600 bytes.
     </dd><dt class="description">
<span 
class="pplb7t-">limits.client</span><span 
class="pplb7t-">_read</span><span 
class="pplb7t-">_retries=5</span> </dt><dd 
class="description">How   many   times   it   will   attempt   to   read   a
     complete HTTP header from a client. This prevents attacks where a client
     trickles an incomplete request at you until you run out of resources.
     </dd><dt class="description">
<span 
class="pplb7t-">limits.connection</span><span 
class="pplb7t-">_stack</span><span 
class="pplb7t-">_size=32 * 1024</span> </dt><dd 
class="description">Size of the stack used for connection
     coroutines. If you&#8217;re trying to cram a ton of connections into very little
     RAM, see how low this can go.
     </dd><dt class="description">
<span 
class="pplb7t-">limits.content</span><span 
class="pplb7t-">_length=20 * 1024</span> </dt><dd 
class="description">Maximum                                              allowed
     content length on submitted requests. This is, right now, a hard limit so
     requests that go over it are rejected. Later versions of Mongrel2 will use
     an upload mechanism that will allow any size upload.
     </dd><dt class="description">
<span 
class="pplb7t-">limits.dir</span><span 
class="pplb7t-">_max</span><span 
class="pplb7t-">_path=256</span> </dt><dd 
class="description">Max path length you can set for Dir handlers.
     </dd><dt class="description">
<span 
class="pplb7t-">limits.dir</span><span 
class="pplb7t-">_send</span><span 
class="pplb7t-">_buffer=16 * 1024</span> </dt><dd 
class="description">Maximum   buffer   used   for   file   sending
     when we need to use one.
     </dd><dt class="description">
<span 
class="pplb7t-">limits.fdtask</span><span 
class="pplb7t-">_stack=100 * 1024</span> </dt><dd 
class="description">Stack frame size for the main IO reactor task.
     There&#8217;s only one, so set it high if you can, but it could possibly go lower.
     </dd><dt class="description">
                                                                  

                                                                  
<span 
class="pplb7t-">limits.handler</span><span 
class="pplb7t-">_stack=100 * 1024</span> </dt><dd 
class="description">The stack frame size for any Handler tasks.
     You probably want this high, since there&#8217;s not many of these, but adjust
     and see what your system can handle.
     </dd><dt class="description">
<span 
class="pplb7t-">limits.handler</span><span 
class="pplb7t-">_targets=128</span> </dt><dd 
class="description">The   maximum   number   of   connection   IDs   a
     message from a Handler may target. It&#8217;s not smart to set this really high.
     </dd><dt class="description">
<span 
class="pplb7t-">limits.header</span><span 
class="pplb7t-">_count=128 * 10</span> </dt><dd 
class="description">Maximum number of allowed headers from a
     client connection.
     </dd><dt class="description">
<span 
class="pplb7t-">limits.host</span><span 
class="pplb7t-">_name=256</span> </dt><dd 
class="description">Maximum hostname for Host specifiers and other DNS
     related settings.
     </dd><dt class="description">
<span 
class="pplb7t-">limits.mime</span><span 
class="pplb7t-">_ext</span><span 
class="pplb7t-">_len=128</span> </dt><dd 
class="description">Maximum length of MIME type extensions.
     </dd><dt class="description">
<span 
class="pplb7t-">limits.proxy</span><span 
class="pplb7t-">_read</span><span 
class="pplb7t-">_retries=100</span> </dt><dd 
class="description">The number of read attempts Mongrel2 should
     make when reading from a backend proxy. Many backend servers don&#8217;t
     buffer their I/O properly and Mongrel2 will ditch their HTTP response
     if it doesn&#8217;t get a header after this many attempts.
     </dd><dt class="description">
<span 
class="pplb7t-">limits.proxy</span><span 
class="pplb7t-">_read</span><span 
class="pplb7t-">_retry</span><span 
class="pplb7t-">_warn=10</span> </dt><dd 
class="description">This  is  the  threshold  where  you  get  a
     warning  that  a  particular  backend  is  having  performance  problems,
     useful for spotting potential errors before they become a problem.
     </dd><dt class="description">
<span 
class="pplb7t-">limits.url</span><span 
class="pplb7t-">_path=256</span> </dt><dd 
class="description">Max URL paths. Does not include query string, just path.
     </dd><dt class="description">
<span 
class="pplb7t-">superpoll.hot</span><span 
class="pplb7t-">_dividend=4</span> </dt><dd 
class="description">Ratio of the total (like 1/4th, 1/8th) that should be
     in the hot selection. Set this higher if you have lots of idle connections;
     set it lower if you have more active connections.
     </dd><dt class="description">
<span 
class="pplb7t-">superpoll.max</span><span 
class="pplb7t-">_fd=10 * 1024</span> </dt><dd 
class="description">Maximum  possible  open  files.  Do  not  set  this
     above  64  *  1024,  and  expect  it  to  take  a  bit  while  Mongrel2  sets  up
     constant structures.
     </dd><dt class="description">
<span 
class="pplb7t-">upload.temp</span><span 
class="pplb7t-">_store=None</span> </dt><dd 
class="description">This is not set by default. If you want large requests
     to reach your handlers, then set this to a directory they can access, and
     make  sure  they  can  handle  it.  Read  about  it  in  the  Hacking  section
     under Uploads. The file has to end in XXXXXX chars to work (read man
     mkstemp).
                                                                  

                                                                  
     </dd><dt class="description">
<span 
class="pplb7t-">upload.temp</span><span 
class="pplb7t-">_store</span><span 
class="pplb7t-">_mode=0666</span> </dt><dd 
class="description">The  mode  to  chmod  any  files  uploaded  to
     upload.temp_store.
     </dd><dt class="description">
<span 
class="pplb7t-">zeromq.threads=1</span> </dt><dd 
class="description">Number   of   0MQ   IO   threads   to   run.   Careful,   we&#8217;ve
     experienced thread bugs in 0MQ sometimes with high numbers of these.
     </dd><dt class="description">
<span 
class="pplb7t-">limits.tick</span><span 
class="pplb7t-">_timer=10</span> </dt><dd 
class="description">Mongrel2  keeps  an  internal  clock  for  efficiency  and  to
     run the timeouts. This is how often that clock updates, and defaults to 10
     seconds.
     </dd><dt class="description">
<span 
class="pplb7t-">limits.min</span><span 
class="pplb7t-">_ping=120</span> </dt><dd 
class="description">Minimum  time  since  last  activity  before  considering
     closing a socket. Set to 0 to disable it.
     </dd><dt class="description">
<span 
class="pplb7t-">limits.min</span><span 
class="pplb7t-">_write</span><span 
class="pplb7t-">_rate=300</span> </dt><dd 
class="description">Minimum       bytes/second       written       before
     considering closing a socket. Set to 0 to disable it.
     </dd><dt class="description">
<span 
class="pplb7t-">limits.min</span><span 
class="pplb7t-">_read</span><span 
class="pplb7t-">_rate=300</span> </dt><dd 
class="description">Minimum  bytes/second  read  before  considering
     closing a socket. Set to 0 to disable it.
     </dd><dt class="description">
<span 
class="pplb7t-">limits.kill</span><span 
class="pplb7t-">_limit=2</span> </dt><dd 
class="description">How     many     of     min_ping,     min_write_rate,     and
     min_read_rate have to trigger before a socket is killed.</dd></dl>
<!--l. 1014--><p class="noindent" >You can also update your <span 
class="pcrro7t-">mimetypes </span>in the same way, just set a variable with
them:
                                                                  

                                                                  
<!--l. 1016--><p class="noindent" ><a 
 id="x6-40007r15"></a><hr class="float"><div class="float" 
>
                                                                  

                                                                  
 <div class="caption" 
><span class="id">Source 15: </span><span  
class="content">                                                                                                      <span 
class="pplri7t-">Changing</span>
<span 
class="pplri7t-">Mimetypes</span></span></div><!--tex4ht:label?: x6-40007r15 -->
<!--l. 1017-->
<div class="lstlisting" id="listing-6"><span class="label"><a 
 id="x6-40008r1"></a></span><span 
class="pcrr7t-x-x-90">settings</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">=</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">{"</span><span 
class="pcrr7t-x-x-90">zeromq</span><span 
class="pcrr7t-x-x-90">.</span><span 
class="pcrr7t-x-x-90">threads</span><span 
class="pcrr7t-x-x-90">":</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">1,</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">"</span><span 
class="pcrr7t-x-x-90">limits</span><span 
class="pcrr7t-x-x-90">.</span><span 
class="pcrr7t-x-x-90">url_path</span><span 
class="pcrr7t-x-x-90">":</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">1024}</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-40009r2"></a></span><span 
class="pcrr7t-x-x-90">mimetypes</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">=</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">{".</span><span 
class="pcrr7t-x-x-90">txt</span><span 
class="pcrr7t-x-x-90">":</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">"</span><span 
class="pcrr7t-x-x-90">text</span><span 
class="pcrr7t-x-x-90">/</span><span 
class="pcrr7t-x-x-90">superawesome</span><span 
class="pcrr7t-x-x-90">"}</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-40010r3"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-40011r4"></a></span><span 
class="pcrr7t-x-x-90">servers</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">=</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">[</span><span 
class="pcrr7t-x-x-90">main</span><span 
class="pcrr7t-x-x-90">]</span>
</div>
                                                                  

                                                                  
</div><hr class="endfloat" />
<h3 class="sectionHead"><span class="titlemark">3.11    </span> <a 
 id="x6-410003.11"></a>SSL Configuration</h3>
<!--l. 1029--><p class="noindent" >Mongrel2 now supports SSL, with preliminary support for SSL session caching. As
of v1.8.0 (actually earlier) you can enable SSL very easily for your Mongrel2 server.
Mongrel2 configures SSL certs with two options in <span 
class="pcrro7t-">settings</span>, and then a
directory of .crt and .key files named after the UUID of the servers that need
them.
<!--l. 1034--><p class="noindent" >To get started, you can make a simple self-signed certificate with some weak
encryption and setup your certs directory:
                                                                  

                                                                  
<!--l. 1037--><p class="noindent" ><a 
 id="x6-41001r16"></a><hr class="float"><div class="float" 
>
                                                                  

                                                                  
 <div class="caption" 
><span class="id">Source 16: </span><span  
class="content">                                                                                  <span 
class="pplri7t-">Making A Self-Signed</span>
<span 
class="pplri7t-">Certificate</span></span></div><!--tex4ht:label?: x6-41001r16 -->
<div class="fancyvrb" id="fancyvrb12"><a 
 id="x6-41003r1"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span id="textcolor200"><span 
class="pcrr7t-x-x-90">#</span><span 
class="pcrr7t-x-x-90">&#x00A0;make</span><span 
class="pcrr7t-x-x-90">&#x00A0;a</span><span 
class="pcrr7t-x-x-90">&#x00A0;certs</span><span 
class="pcrr7t-x-x-90">&#x00A0;directory</span></span><br class="fancyvrb" /><a 
 id="x6-41005r2"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;mkdir</span><span 
class="pcrr7t-x-x-90">&#x00A0;certs</span><br class="fancyvrb" /><a 
 id="x6-41007r3"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br class="fancyvrb" /><a 
 id="x6-41009r4"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span id="textcolor201"><span 
class="pcrr7t-x-x-90">#</span><span 
class="pcrr7t-x-x-90">&#x00A0;list</span><span 
class="pcrr7t-x-x-90">&#x00A0;out</span><span 
class="pcrr7t-x-x-90">&#x00A0;your</span><span 
class="pcrr7t-x-x-90">&#x00A0;servers</span><span 
class="pcrr7t-x-x-90">&#x00A0;so</span><span 
class="pcrr7t-x-x-90">&#x00A0;you</span><span 
class="pcrr7t-x-x-90">&#x00A0;can</span><span 
class="pcrr7t-x-x-90">&#x00A0;get</span><span 
class="pcrr7t-x-x-90">&#x00A0;the</span><span 
class="pcrr7t-x-x-90">&#x00A0;UUID</span></span>
<br class="fancyvrb" /><a 
 id="x6-41011r5"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;m2sh</span><span 
class="pcrr7t-x-x-90">&#x00A0;servers</span><br class="fancyvrb" /><a 
 id="x6-41013r6"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br class="fancyvrb" /><a 
 id="x6-41015r7"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span id="textcolor202"><span 
class="pcrr7t-x-x-90">#</span><span 
class="pcrr7t-x-x-90">&#x00A0;go</span><span 
class="pcrr7t-x-x-90">&#x00A0;into</span><span 
class="pcrr7t-x-x-90">&#x00A0;the</span><span 
class="pcrr7t-x-x-90">&#x00A0;certs</span><span 
class="pcrr7t-x-x-90">&#x00A0;directory</span></span><br class="fancyvrb" /><a 
 id="x6-41017r8"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span id="textcolor203"><span 
class="pcrr7t-x-x-90">cd</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span></span><span 
class="pcrr7t-x-x-90">certs</span><br class="fancyvrb" /><a 
 id="x6-41019r9"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span>
<br class="fancyvrb" /><a 
 id="x6-41021r10"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span id="textcolor204"><span 
class="pcrr7t-x-x-90">#</span><span 
class="pcrr7t-x-x-90">&#x00A0;make</span><span 
class="pcrr7t-x-x-90">&#x00A0;a</span><span 
class="pcrr7t-x-x-90">&#x00A0;self-signed</span><span 
class="pcrr7t-x-x-90">&#x00A0;weak</span><span 
class="pcrr7t-x-x-90">&#x00A0;cert</span><span 
class="pcrr7t-x-x-90">&#x00A0;to</span><span 
class="pcrr7t-x-x-90">&#x00A0;play</span><span 
class="pcrr7t-x-x-90">&#x00A0;with</span></span><br class="fancyvrb" /><a 
 id="x6-41023r11"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;openssl</span><span 
class="pcrr7t-x-x-90">&#x00A0;genrsa</span><span 
class="pcrr7t-x-x-90">&#x00A0;-des3</span><span 
class="pcrr7t-x-x-90">&#x00A0;-out</span><span 
class="pcrr7t-x-x-90">&#x00A0;server.key</span><span 
class="pcrr7t-x-x-90">&#x00A0;512</span>
<br class="fancyvrb" /><a 
 id="x6-41025r12"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;openssl</span><span 
class="pcrr7t-x-x-90">&#x00A0;req</span><span 
class="pcrr7t-x-x-90">&#x00A0;-new</span><span 
class="pcrr7t-x-x-90">&#x00A0;-key</span><span 
class="pcrr7t-x-x-90">&#x00A0;server.key</span><span 
class="pcrr7t-x-x-90">&#x00A0;-out</span><span 
class="pcrr7t-x-x-90">&#x00A0;server.csr</span>
<br class="fancyvrb" /><a 
 id="x6-41027r13"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;cp</span><span 
class="pcrr7t-x-x-90">&#x00A0;server.key</span><span 
class="pcrr7t-x-x-90">&#x00A0;server.key.org</span><br class="fancyvrb" /><a 
 id="x6-41029r14"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;openssl</span><span 
class="pcrr7t-x-x-90">&#x00A0;rsa</span><span 
class="pcrr7t-x-x-90">&#x00A0;-in</span><span 
class="pcrr7t-x-x-90">&#x00A0;server.key.org</span><span 
class="pcrr7t-x-x-90">&#x00A0;-out</span><span 
class="pcrr7t-x-x-90">&#x00A0;server.key</span>
<br class="fancyvrb" /><a 
 id="x6-41031r15"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;openssl</span><span 
class="pcrr7t-x-x-90">&#x00A0;x509</span><span 
class="pcrr7t-x-x-90">&#x00A0;-req</span><span 
class="pcrr7t-x-x-90">&#x00A0;-days</span><span 
class="pcrr7t-x-x-90">&#x00A0;365</span><span 
class="pcrr7t-x-x-90">&#x00A0;-in</span><span 
class="pcrr7t-x-x-90">&#x00A0;server.csr</span><span 
class="pcrr7t-x-x-90">&#x00A0;-signkey</span><span 
class="pcrr7t-x-x-90">&#x00A0;server.key</span><span 
class="pcrr7t-x-x-90">&#x00A0;-out</span><span 
class="pcrr7t-x-x-90">&#x00A0;server.crt</span><br class="fancyvrb" /><a 
 id="x6-41033r16"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span>
<br class="fancyvrb" /><a 
 id="x6-41035r17"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span id="textcolor205"><span 
class="pcrr7t-x-x-90">#</span><span 
class="pcrr7t-x-x-90">&#x00A0;finally,</span><span 
class="pcrr7t-x-x-90">&#x00A0;copy</span><span 
class="pcrr7t-x-x-90">&#x00A0;the</span><span 
class="pcrr7t-x-x-90">&#x00A0;sesrver.crt</span><span 
class="pcrr7t-x-x-90">&#x00A0;and</span><span 
class="pcrr7t-x-x-90">&#x00A0;server.key</span><span 
class="pcrr7t-x-x-90">&#x00A0;files</span><span 
class="pcrr7t-x-x-90">&#x00A0;over</span><span 
class="pcrr7t-x-x-90">&#x00A0;to</span><span 
class="pcrr7t-x-x-90">&#x00A0;the</span><span 
class="pcrr7t-x-x-90">&#x00A0;UUID</span><span 
class="pcrr7t-x-x-90">&#x00A0;for</span><span 
class="pcrr7t-x-x-90">&#x00A0;that</span></span>
<br class="fancyvrb" /><a 
 id="x6-41037r18"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span id="textcolor206"><span 
class="pcrr7t-x-x-90">#</span><span 
class="pcrr7t-x-x-90">&#x00A0;server</span><span 
class="pcrr7t-x-x-90">&#x00A0;configuration</span><span 
class="pcrr7t-x-x-90">&#x00A0;in</span><span 
class="pcrr7t-x-x-90">&#x00A0;your</span><span 
class="pcrr7t-x-x-90">&#x00A0;mongrel2.conf</span></span>
<br class="fancyvrb" /><a 
 id="x6-41039r19"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;mv</span><span 
class="pcrr7t-x-x-90">&#x00A0;server.crt</span><span 
class="pcrr7t-x-x-90">&#x00A0;2f62bd5-9e59-49cd-993c-3b6013c28f05.crt</span>
<br class="fancyvrb" /><a 
 id="x6-41041r20"></a><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;mv</span><span 
class="pcrr7t-x-x-90">&#x00A0;server.key</span><span 
class="pcrr7t-x-x-90">&#x00A0;2f62bd5-9e59-49cd-993c-3b6013c28f05.key</span></div>
                                                                  

                                                                  
</div><hr class="endfloat" />
<!--l. 1063--><p class="noindent" >I actually have a shell script kind of like this, since I can never remember how to set
this stuff up with openssl. Also, you should really adjust the RSA key strength from
512 to something you&#8217;re comfortable with. I&#8217;m using a weak key here so you can do
performance testing and thrashing, and then compare with your real key
later.
<!--l. 1069--><p class="noindent" >Once you have that done, you just have to add three little settings to your mongrel2
conf:
     <ol  class="enumerate1" >
     <li 
  class="enumerate" id="x6-41043x1">Add  the  setting  <span 
class="pcrro7t-">certdir </span>pointed  at  <span 
class="pcrb7t-">./certs/</span>.  Make  sure  it  has  the
     trailing slash!
     </li>
     <li 
  class="enumerate" id="x6-41045x2">Add the <span 
class="pcrro7t-">Server.use</span><span 
class="pcrro7t-">_ssl = 1 </span>value to the Server that has the UUID
     you just created a cert for.
     </li>
     <li 
  class="enumerate" id="x6-41047x3">Optionally, set the setting <span 
class="pcrro7t-">ssl</span><span 
class="pcrro7t-">_ciphers </span>to <span 
class="pcrro7t-">SSL</span><span 
class="pcrro7t-">_RSA</span><span 
class="pcrro7t-">_RC4</span><span 
class="pcrro7t-">_128</span><span 
class="pcrro7t-">_SHA </span>so
     you can play with the performance of a weak cipher. If you unset this,
     Mongrel2 will use the best one the browser asks for.</li></ol>
<!--l. 1081--><p class="noindent" >After that, your config should look something like this:
                                                                  

                                                                  
<!--l. 1083--><p class="noindent" ><a 
 id="x6-41048r17"></a><hr class="float"><div class="float" 
>
                                                                  

                                                                  
 <div class="caption" 
><span class="id">Source 17: </span><span  
class="content">                                                                                                <span 
class="pplri7t-">Minimal SSL</span>
<span 
class="pplri7t-">Configuration</span></span></div><!--tex4ht:label?: x6-41048r17 -->
<!--l. 1084-->
<div class="lstlisting" id="listing-7"><span class="label"><a 
 id="x6-41049r1"></a></span><span 
class="pcrr7t-x-x-90">main</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">=</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">Server</span><span 
class="pcrr7t-x-x-90">(</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-41050r2"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">uuid</span><span 
class="pcrr7t-x-x-90">="2</span><span 
class="pcrr7t-x-x-90">f62bd5</span><span 
class="pcrr7t-x-x-90">-9</span><span 
class="pcrr7t-x-x-90">e59</span><span 
class="pcrr7t-x-x-90">-49</span><span 
class="pcrr7t-x-x-90">cd</span><span 
class="pcrr7t-x-x-90">-993</span><span 
class="pcrr7t-x-x-90">c</span><span 
class="pcrr7t-x-x-90">-3</span><span 
class="pcrr7t-x-x-90">b6013c28f05</span><span 
class="pcrr7t-x-x-90">",</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-41051r3"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">use_ssl</span><span 
class="pcrr7t-x-x-90">=1,</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-41052r4"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">access_log</span><span 
class="pcrr7t-x-x-90">="/</span><span 
class="pcrr7t-x-x-90">logs</span><span 
class="pcrr7t-x-x-90">/</span><span 
class="pcrr7t-x-x-90">access</span><span 
class="pcrr7t-x-x-90">.</span><span 
class="pcrr7t-x-x-90">log</span><span 
class="pcrr7t-x-x-90">",</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-41053r5"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">error_log</span><span 
class="pcrr7t-x-x-90">="/</span><span 
class="pcrr7t-x-x-90">logs</span><span 
class="pcrr7t-x-x-90">/</span><span 
class="pcrr7t-x-x-90">error</span><span 
class="pcrr7t-x-x-90">.</span><span 
class="pcrr7t-x-x-90">log</span><span 
class="pcrr7t-x-x-90">",</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-41054r6"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">chroot</span><span 
class="pcrr7t-x-x-90">="./",</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-41055r7"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">pid_file</span><span 
class="pcrr7t-x-x-90">="/</span><span 
class="pcrr7t-x-x-90">run</span><span 
class="pcrr7t-x-x-90">/</span><span 
class="pcrr7t-x-x-90">mongrel2</span><span 
class="pcrr7t-x-x-90">.</span><span 
class="pcrr7t-x-x-90">pid</span><span 
class="pcrr7t-x-x-90">",</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-41056r8"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">default_host</span><span 
class="pcrr7t-x-x-90">="</span><span 
class="pcrr7t-x-x-90">mongrel2</span><span 
class="pcrr7t-x-x-90">.</span><span 
class="pcrr7t-x-x-90">org</span><span 
class="pcrr7t-x-x-90">",</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-41057r9"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">name</span><span 
class="pcrr7t-x-x-90">="</span><span 
class="pcrr7t-x-x-90">main</span><span 
class="pcrr7t-x-x-90">",</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-41058r10"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">port</span><span 
class="pcrr7t-x-x-90">=6767,</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-41059r11"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">hosts</span><span 
class="pcrr7t-x-x-90">=[</span><span 
class="pcrr7t-x-x-90">mysite</span><span 
class="pcrr7t-x-x-90">]</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-41060r12"></a></span><span 
class="pcrr7t-x-x-90">)</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-41061r13"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-41062r14"></a></span><span 
class="pcrr7t-x-x-90">settings</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">=</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">{</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-41063r15"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">"</span><span 
class="pcrr7t-x-x-90">certdir</span><span 
class="pcrr7t-x-x-90">":</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">"./</span><span 
class="pcrr7t-x-x-90">certs</span><span 
class="pcrr7t-x-x-90">/"</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-41064r16"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">"</span><span 
class="pcrr7t-x-x-90">ssl_ciphers</span><span 
class="pcrr7t-x-x-90">":</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">"</span><span 
class="pcrr7t-x-x-90">SSL_RSA_RC4_128_SHA</span><span 
class="pcrr7t-x-x-90">"</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-41065r17"></a></span><span 
class="pcrr7t-x-x-90">}</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-41066r18"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-41067r19"></a></span><span 
class="pcrr7t-x-x-90">servers</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">=</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">[</span><span 
class="pcrr7t-x-x-90">main</span><span 
class="pcrr7t-x-x-90">]</span>
</div>
                                                                  

                                                                  
</div><hr class="endfloat" />
<!--l. 1109--><p class="noindent" >Get that written, rerun <span 
class="pcrro7t-">m2sh config </span>to make the new config, restart Mongrel2 (you
can&#8217;t reload to enable SSL), and it should be working.
<!--l. 1112--><p class="noindent" >After you get this working you just have to get your own certificate, put it
in the certs directory with the right filename, and you should be good to
go.
<h4 class="subsectionHead"><span class="titlemark">3.11.1    </span> <a 
 id="x6-420003.11.1"></a>SNI Support</h4>
<!--l. 1117--><p class="noindent" >Starting with 1.9.0, mongrel2 adds SNI support. On any request, mongrel2
will first search for files named <span 
class="pplri7t-">hostname</span>.crt and <span 
class="pplri7t-">hostname</span>.key &#8211; if found,
those will be used, otherwise it will fallback to the UUID key and certificate
files.
<!--l. 1122--><p class="noindent" >
<h4 class="subsectionHead"><span class="titlemark">3.11.2    </span> <a 
 id="x6-430003.11.2"></a>Experimental SSL Caching</h4>
<!--l. 1124--><p class="noindent" >We&#8217;ve got experimental SSL caching working, which will try to reuse the
browser&#8217;s SSL session if it&#8217;s there. This is meant to be a trade-off between
memory and performance, so it can chew a bunch of RAM if you have a lot of
SSL traffic over a short period of time. We&#8217;ll be making the caching more
configurable, but for now, it&#8217;s working and does speed up SSL clients that do it
properly.
<!--l. 1131--><p class="noindent" >
<h3 class="sectionHead"><span class="titlemark">3.12    </span> <a 
 id="x6-440003.12"></a>Configuring Filters (BETA)</h3>
<!--l. 1133--><p class="noindent" >The Mongrel2 v1.8.0 release also included working filters that you can configure and
load dynamically. The filters are very fresh, and the only one available is
the null filter found in <span 
class="pcrb7t-">tools/filters/null.c </span>but it does work and
you can configure it. It&#8217;s also currently not hooked into the reload gear that
we&#8217;ve recently done, so don&#8217;t expect it to work if you do frequently hot
reloading.
<!--l. 1140--><p class="noindent" >Configuring a filter is fairly easy, take a look at this example:
                                                                  

                                                                  
<!--l. 1142--><p class="noindent" ><a 
 id="x6-44001r18"></a><hr class="float"><div class="float" 
>
                                                                  

                                                                  
 <div class="caption" 
><span class="id">Source 18: </span><span  
class="content">                                                                                              <span 
class="pplri7t-">Minimal Filter</span>
<span 
class="pplri7t-">Configuration</span></span></div><!--tex4ht:label?: x6-44001r18 -->
<!--l. 1143-->
<div class="lstlisting" id="listing-8"><span class="label"><a 
 id="x6-44002r1"></a></span><span 
class="pcrr7t-x-x-90">null</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">=</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">Filter</span><span 
class="pcrr7t-x-x-90">(</span><span 
class="pcrr7t-x-x-90">name</span><span 
class="pcrr7t-x-x-90">="/</span><span 
class="pcrr7t-x-x-90">usr</span><span 
class="pcrr7t-x-x-90">/</span><span 
class="pcrr7t-x-x-90">local</span><span 
class="pcrr7t-x-x-90">/</span><span 
class="pcrr7t-x-x-90">lib</span><span 
class="pcrr7t-x-x-90">/</span><span 
class="pcrr7t-x-x-90">mongrel2</span><span 
class="pcrr7t-x-x-90">/</span><span 
class="pcrr7t-x-x-90">filters</span><span 
class="pcrr7t-x-x-90">/</span><span 
class="pcrr7t-x-x-90">null</span><span 
class="pcrr7t-x-x-90">.</span><span 
class="pcrr7t-x-x-90">so</span><span 
class="pcrr7t-x-x-90">",</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">settings</span><span 
class="pcrr7t-x-x-90">={</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-44003r2"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">"</span><span 
class="pcrr7t-x-x-90">extensions</span><span 
class="pcrr7t-x-x-90">":</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">["&#x22C6;.</span><span 
class="pcrr7t-x-x-90">html</span><span 
class="pcrr7t-x-x-90">",</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">"&#x22C6;.</span><span 
class="pcrr7t-x-x-90">txt</span><span 
class="pcrr7t-x-x-90">"],</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-44004r3"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">"</span><span 
class="pcrr7t-x-x-90">min_size</span><span 
class="pcrr7t-x-x-90">":</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">1000</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-44005r4"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">})</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-44006r5"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-44007r6"></a></span><span 
class="pcrr7t-x-x-90">main</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">=</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">Server</span><span 
class="pcrr7t-x-x-90">(</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-44008r7"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">uuid</span><span 
class="pcrr7t-x-x-90">="</span><span 
class="pcrr7t-x-x-90">f400bf85</span><span 
class="pcrr7t-x-x-90">-4538-4</span><span 
class="pcrr7t-x-x-90">f7a</span><span 
class="pcrr7t-x-x-90">-8908-67</span><span 
class="pcrr7t-x-x-90">e313d515c2</span><span 
class="pcrr7t-x-x-90">",</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-44009r8"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">access_log</span><span 
class="pcrr7t-x-x-90">="/</span><span 
class="pcrr7t-x-x-90">logs</span><span 
class="pcrr7t-x-x-90">/</span><span 
class="pcrr7t-x-x-90">access</span><span 
class="pcrr7t-x-x-90">.</span><span 
class="pcrr7t-x-x-90">log</span><span 
class="pcrr7t-x-x-90">",</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-44010r9"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">error_log</span><span 
class="pcrr7t-x-x-90">="/</span><span 
class="pcrr7t-x-x-90">logs</span><span 
class="pcrr7t-x-x-90">/</span><span 
class="pcrr7t-x-x-90">error</span><span 
class="pcrr7t-x-x-90">.</span><span 
class="pcrr7t-x-x-90">log</span><span 
class="pcrr7t-x-x-90">",</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-44011r10"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">chroot</span><span 
class="pcrr7t-x-x-90">="./",</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-44012r11"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">default_host</span><span 
class="pcrr7t-x-x-90">="</span><span 
class="pcrr7t-x-x-90">localhost</span><span 
class="pcrr7t-x-x-90">",</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-44013r12"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">name</span><span 
class="pcrr7t-x-x-90">="</span><span 
class="pcrr7t-x-x-90">test</span><span 
class="pcrr7t-x-x-90">",</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-44014r13"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">pid_file</span><span 
class="pcrr7t-x-x-90">="/</span><span 
class="pcrr7t-x-x-90">run</span><span 
class="pcrr7t-x-x-90">/</span><span 
class="pcrr7t-x-x-90">mongrel2</span><span 
class="pcrr7t-x-x-90">.</span><span 
class="pcrr7t-x-x-90">pid</span><span 
class="pcrr7t-x-x-90">",</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-44015r14"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">port</span><span 
class="pcrr7t-x-x-90">=6767,</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-44016r15"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">hosts</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">=</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">[</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-44017r16"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">Host</span><span 
class="pcrr7t-x-x-90">(</span><span 
class="pcrr7t-x-x-90">name</span><span 
class="pcrr7t-x-x-90">="</span><span 
class="pcrr7t-x-x-90">localhost</span><span 
class="pcrr7t-x-x-90">",</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">routes</span><span 
class="pcrr7t-x-x-90">={</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-44018r17"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr8c-x-x-90">&#8217;</span><span 
class="pcrr7t-x-x-90">/</span><span 
class="pcrr7t-x-x-90">tests</span><span 
class="pcrr7t-x-x-90">/</span><span 
class="pcrr8c-x-x-90">&#8217;</span><span 
class="pcrr7t-x-x-90">:</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">Dir</span><span 
class="pcrr7t-x-x-90">(</span><span 
class="pcrr7t-x-x-90">base</span><span 
class="pcrr7t-x-x-90">=</span><span 
class="pcrr8c-x-x-90">&#8217;</span><span 
class="pcrr7t-x-x-90">tests</span><span 
class="pcrr7t-x-x-90">/</span><span 
class="pcrr8c-x-x-90">&#8217;</span><span 
class="pcrr7t-x-x-90">,</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">index_file</span><span 
class="pcrr7t-x-x-90">=</span><span 
class="pcrr8c-x-x-90">&#8217;</span><span 
class="pcrr7t-x-x-90">index</span><span 
class="pcrr7t-x-x-90">.</span><span 
class="pcrr7t-x-x-90">html</span><span 
class="pcrr8c-x-x-90">&#8217;</span><span 
class="pcrr7t-x-x-90">,</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-44019r18"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">default_ctype</span><span 
class="pcrr7t-x-x-90">=</span><span 
class="pcrr8c-x-x-90">&#8217;</span><span 
class="pcrr7t-x-x-90">text</span><span 
class="pcrr7t-x-x-90">/</span><span 
class="pcrr7t-x-x-90">plain</span><span 
class="pcrr8c-x-x-90">&#8217;</span><span 
class="pcrr7t-x-x-90">)</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-44020r19"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr8c-x-x-90">&#8217;</span><span 
class="pcrr7t-x-x-90">/</span><span 
class="pcrr7t-x-x-90">nulltest</span><span 
class="pcrr7t-x-x-90">/</span><span 
class="pcrr8c-x-x-90">&#8217;</span><span 
class="pcrr7t-x-x-90">:</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">Proxy</span><span 
class="pcrr7t-x-x-90">(</span><span 
class="pcrr7t-x-x-90">addr</span><span 
class="pcrr7t-x-x-90">=</span><span 
class="pcrr8c-x-x-90">&#8217;</span><span 
class="pcrr7t-x-x-90">127.0.0.1</span><span 
class="pcrr8c-x-x-90">&#8217;</span><span 
class="pcrr7t-x-x-90">,</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">port</span><span 
class="pcrr7t-x-x-90">=8080)</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-44021r20"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">})</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-44022r21"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">]</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-44023r22"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">filters</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">=</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">[</span><span 
class="pcrr7t-x-x-90">null</span><span 
class="pcrr7t-x-x-90">]</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-44024r23"></a></span><span 
class="pcrr7t-x-x-90">)</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-44025r24"></a></span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><br /><span class="label"><a 
 id="x6-44026r25"></a></span><span 
class="pcrr7t-x-x-90">servers</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">=</span><span 
class="pcrr7t-x-x-90">&#x00A0;</span><span 
class="pcrr7t-x-x-90">[</span><span 
class="pcrr7t-x-x-90">main</span><span 
class="pcrr7t-x-x-90">]</span>
</div>
                                                                  

                                                                  
</div><hr class="endfloat" />
<!--l. 1173--><p class="noindent" >First you can see that we setup the <span 
class="pcrro7t-">null </span>filter with some arbitrary settings and
point to where the .so file is. Filters can be configured with any arbitrarily
nested data structure that can fit into a tnetstring, so you can pass them
pretty much anything that matters. Lists, dicts, numbers, strings, are the
main ones. You can also use variables in the config file, so you could create
different servers and share config options for Filters and other parts of the
files.
<!--l. 1181--><p class="noindent" >After that, there&#8217;s simply a <span 
class="pcrro7t-">Server.filters </span>which takes a list of filters to load. If
you don&#8217;t set this variable, then the filter gear isn&#8217;t even loaded and your server
behaves as normal. If you do set this variable, then the filters are installed and will
work.
<!--l. 1186--><p class="noindent" >If you run this config, you&#8217;ll see the filter printing out it&#8217;s config as a tnetstring, and
then closing the connection, but only if you go to <span 
class="pcrro7t-">/nulltest/</span>. If you go to
<span 
class="pcrro7t-">/tests/sample.html </span>to get at a directory, it&#8217;ll not even run.
<!--l. 1191--><p class="noindent" >We&#8217;ll have more documentation on actually writing filters in the Hacking
section.
                                                                  

                                                                  
                                                                  

                                                                  
                                                                  

                                                                  
<!--l. 1--><div class="crosslinks"><p class="noindent">[<a 
href="book-finalch5.html" >next</a>] [<a 
href="book-finalch3.html" >prev</a>] [<a 
href="book-finalch3.html#tailbook-finalch3.html" >prev-tail</a>] [<a 
href="book-finalch4.html" >front</a>] [<a 
href="book-final.html#book-finalch4.html" >up</a>] </p></div>
<!--l. 1--><p class="noindent" ><a 
 id="tailbook-finalch4.html"></a>  
</body></html> 
